(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d0d6f80"],{"758d":function(e,t,r){"use strict";r.d(t,"a",function(){return I}),r.d(t,"b",function(){return Pr}),r.d(t,"c",function(){return kr}),r.d(t,"d",function(){return Hr}),r.d(t,"e",function(){return Ur}),r.d(t,"f",function(){return me}),r.d(t,"g",function(){return w}),r.d(t,"h",function(){return Nt}),r.d(t,"i",function(){return we}),r.d(t,"j",function(){return Pe}),r.d(t,"k",function(){return Ct}),r.d(t,"l",function(){return Ie}),r.d(t,"m",function(){return de}),r.d(t,"n",function(){return Sr}),r.d(t,"o",function(){return Ft}),r.d(t,"p",function(){return Ot}),r.d(t,"q",function(){return ie}),r.d(t,"r",function(){return Bt}),r.d(t,"s",function(){return Fe}),r.d(t,"t",function(){return Dr}),r.d(t,"u",function(){return Fr}),r.d(t,"v",function(){return Br}),r.d(t,"w",function(){return Mr});var p=r("0e1d"),m=r("0a92"),v=r("214a"),i=r("aedf"),n=r("908d"),u=r("a47c");
/*!
 * @pixi/core - v6.2.1
 * Compiled Tue, 21 Dec 2021 19:56:15 UTC
 *
 * @pixi/core is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */p.b.PREFER_ENV=v.o.any?m.g.WEBGL:m.g.WEBGL2,p.b.STRICT_TEXTURE_CACHE=!1;var s=[];function g(e,t){if(!e)return null;var r,i="";"string"!=typeof e||(r=/\.(\w{3,4})(?:$|\?|#)/i.exec(e))&&(i=r[1].toLowerCase());for(var n=s.length-1;0<=n;--n){var o=s[n];if(o.test&&o.test(e,i))return new o(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function a(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var h=function(){return(h=Object.assign||function(e){for(var t,r=arguments,i=1,n=arguments.length;i<n;i++)for(var o in t=r[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};var l,d,f,c,y,_,b,x,E,T,R,S=(Y.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},Y.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},Y.prototype.resize=function(e,t){e===this._width&&t===this._height||(this._width=e,this._height=t,this.onResize.emit(e,t))},Object.defineProperty(Y.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),Y.prototype.update=function(){this.destroyed||this.onUpdate.emit()},Y.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(Y.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Y.prototype.style=function(e,t,r){return!1},Y.prototype.dispose=function(){},Y.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Y.test=function(e,t){return!1},Y),w=(a(W,R=S),W.prototype.upload=function(e,t,r){var i=e.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===m.a.UNPACK);var n=t.realWidth,e=t.realHeight;return r.width===n&&r.height===e?i.texSubImage2D(t.target,0,0,0,n,e,t.format,r.type,this.data):(r.width=n,r.height=e,i.texImage2D(t.target,0,r.internalFormat,n,e,0,t.format,r.type,this.data)),!0},W.prototype.dispose=function(){this.data=null},W.test=function(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array},W),A={scaleMode:m.p.NEAREST,format:m.h.RGBA,alphaMode:m.a.NPM},I=(a(z,T=v.c),Object.defineProperty(z.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"mipmap",{get:function(){return this._mipmap},set:function(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),z.prototype.setStyle=function(e,t){var r;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this},z.prototype.setSize=function(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)},z.prototype.setRealSize=function(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this},z.prototype._refreshPOT=function(){this.isPowerOfTwo=Object(v.p)(this.realWidth)&&Object(v.p)(this.realHeight)},z.prototype.setResolution=function(e){var t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT()),this},z.prototype.setResource=function(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this},z.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):0<this.width&&0<this.height&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},z.prototype.onError=function(e){this.emit("error",this,e)},z.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete v.a[this.cacheId],delete v.e[this.cacheId],this.cacheId=null),this.dispose(),z.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},z.prototype.dispose=function(){this.emit("dispose",this)},z.prototype.castToBaseTexture=function(){return this},z.from=function(e,t,r){void 0===r&&(r=p.b.STRICT_TEXTURE_CACHE);var i="string"==typeof e,n=null,n=i?e:(e._pixiId||(o=t&&t.pixiIdPrefix||"pixiid",e._pixiId=o+"_"+Object(v.D)()),e._pixiId),o=v.a[n];if(i&&r&&!o)throw new Error('The cacheId "'+n+'" does not exist in BaseTextureCache.');return o||((o=new z(e,t)).cacheId=n,z.addToCache(o,n)),o},z.fromBuffer=function(e,t,r,i){e=e||new Float32Array(t*r*4);var n=new w(e,{width:t,height:r}),e=e instanceof Float32Array?m.r.FLOAT:m.r.UNSIGNED_BYTE;return new z(n,Object.assign(A,i||{width:t,height:r,type:e}))},z.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),v.a[t],v.a[t]=e)},z.removeFromCache=function(e){if("string"==typeof e){var t=v.a[e];if(t){var r=t.textureCacheIds.indexOf(e);return-1<r&&t.textureCacheIds.splice(r,1),delete v.a[e],t}}else if(e&&e.textureCacheIds){for(var i=0;i<e.textureCacheIds.length;++i)delete v.a[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null},z._globalBatch=0,z),C=(a(X,E=S),X.prototype.initFromArray=function(e,t){for(var r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof S?this.addResourceAt(e[r],r):this.addResourceAt(g(e[r],t),r))},X.prototype.dispose=function(){for(var e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},X.prototype.addResourceAt=function(e,t){if(!this.items[t])throw new Error("Index "+t+" is out of bounds");return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this},X.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");E.prototype.bind.call(this,e);for(var t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)},X.prototype.unbind=function(e){E.prototype.unbind.call(this,e);for(var t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)},X.prototype.load=function(){var r=this;if(this._load)return this._load;var e=this.items.map(function(e){return e.resource}).filter(function(e){return e}).map(function(e){return e.load()});return this._load=Promise.all(e).then(function(){var e=r.items[0],t=e.realWidth,e=e.realHeight;return r.resize(t,e),Promise.resolve(r)}),this._load},X),F=(a(H,x=C),H.prototype.addBaseTextureAt=function(e,t){if(!e.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(e.resource,t),this},H.prototype.bind=function(e){x.prototype.bind.call(this,e),e.target=m.q.TEXTURE_2D_ARRAY},H.prototype.upload=function(e,t,r){var i=this.length,n=this.itemDirtyIds,o=this.items,s=e.gl;r.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,t.format,r.type,null);for(var a=0;a<i;a++){var u=o[a];n[a]<u.dirtyId&&(n[a]=u.dirtyId,u.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,a,u.resource.width,u.resource.height,1,t.format,r.type,u.resource.source))}return!0},H),O=(a(V,b=S),V.crossOrigin=function(e,t,r){void 0===r&&0!==t.indexOf("data:")?e.crossOrigin=Object(v.i)(t):!1!==r&&(e.crossOrigin="string"==typeof r?r:"anonymous")},V.prototype.upload=function(e,t,r,i){var n=e.gl,o=t.realWidth,e=t.realHeight;return i=i||this.source,n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===m.a.UNPACK),this.noSubImage||t.target!==n.TEXTURE_2D||r.width!==o||r.height!==e?(r.width=o,r.height=e,n.texImage2D(t.target,0,r.internalFormat,t.format,r.type,i)):n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.format,r.type,i),!0},V.prototype.update=function(){var e,t;this.destroyed||(e=(t=this.source).naturalWidth||t.videoWidth||t.width,t=t.naturalHeight||t.videoHeight||t.height,this.resize(e,t),b.prototype.update.call(this))},V.prototype.dispose=function(){this.source=null},V),N=(a(j,_=O),j.test=function(e){var t=self.OffscreenCanvas;return!!(t&&e instanceof t)||self.HTMLCanvasElement&&e instanceof HTMLCanvasElement},j),M=(a(k,y=C),k.prototype.bind=function(e){y.prototype.bind.call(this,e),e.target=m.q.TEXTURE_CUBE_MAP},k.prototype.addBaseTextureAt=function(e,t,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[t])throw new Error("Index "+t+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||0<Object.keys(e._glTextures).length){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,t)}else e.target=m.q.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this},k.prototype.upload=function(e,t,r){for(var i=this.itemDirtyIds,n=0;n<k.SIDES;n++){var o=this.items[n];i[n]<o.dirtyId&&(o.valid&&o.resource?(o.resource.upload(e,o,r),i[n]=o.dirtyId):i[n]<-1&&(e.gl.texImage2D(o.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),i[n]=-1))}return!0},k.test=function(e){return Array.isArray(e)&&e.length===k.SIDES},k.SIDES=6,k),B=(a(G,c=O),G.prototype.load=function(e){var n=this;return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise(function(e,t){var r=n.source;n.url=r.src;function i(){n.destroyed||(r.onload=null,r.onerror=null,n.resize(r.width,r.height),n._load=null,n.createBitmap?e(n.process()):e(n))}r.complete&&r.src?i():(r.onload=i,r.onerror=function(e){t(e),n.onError.emit(e)})})),this._load},G.prototype.process=function(){var t=this,r=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var i=self.createImageBitmap,e=!r.crossOrigin||"anonymous"===r.crossOrigin;return this._process=fetch(r.src,{mode:e?"cors":"no-cors"}).then(function(e){return e.blob()}).then(function(e){return i(e,0,0,r.width,r.height,{premultiplyAlpha:t.alphaMode===m.a.UNPACK?"premultiply":"none"})}).then(function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))}),this._process},G.prototype.upload=function(e,t,r){if("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),!this.createBitmap)return c.prototype.upload.call(this,e,t,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(c.prototype.upload.call(this,e,t,r,this.bitmap),!this.preserveBitmap){var i,n=!0,o=t._glTextures;for(i in o){var s=o[i];if(s!==r&&s.dirtyId!==t.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},G.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,c.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},G.test=function(e){return"string"==typeof e||e instanceof HTMLImageElement},G),P=(a(L,f=O),L.prototype.load=function(){var t=this;return this._load||(this._load=new Promise(function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},L.SVG_XML.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()})),this._load},L.prototype._loadSvg=function(){var o=this,s=new Image;O.crossOrigin(s,this.svg,this._crossorigin),s.src=this.svg,s.onerror=function(e){o._resolve&&(s.onerror=null,o.onError.emit(e))},s.onload=function(){if(o._resolve){var e=s.width,t=s.height;if(!e||!t)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var r=e*o.scale,i=t*o.scale;(o._overrideWidth||o._overrideHeight)&&(r=o._overrideWidth||o._overrideHeight/t*e,i=o._overrideHeight||o._overrideWidth/e*t);var r=Math.round(r),i=Math.round(i),n=o.source;n.width=r,n.height=i,n._pixiId="canvas_"+Object(v.D)(),n.getContext("2d").drawImage(s,0,0,e,t,0,0,r,i),o._resolve(),o._resolve=null}}},L.getSize=function(e){var t=L.SVG_SIZE.exec(e),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e},L.prototype.dispose=function(){f.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},L.test=function(e,t){return"svg"===t||"string"==typeof e&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(e)||"string"==typeof e&&L.SVG_XML.test(e)},L.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,L.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,L),t=(a(D,d=O),D.prototype.update=function(e){var t;this.destroyed||(t=n.a.shared.elapsedMS*this.source.playbackRate,this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(d.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0))},D.prototype.load=function(){var t=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(function(e){t.valid?e(t):(t._resolve=e,r.load())}),this._load},D.prototype._onError=function(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)},D.prototype._isSourcePlaying=function(){var e=this.source;return 0<e.currentTime&&!1===e.paused&&!1===e.ended&&2<e.readyState},D.prototype._isSourceReady=function(){var e=this.source;return 3===e.readyState||4===e.readyState},D.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(n.a.shared.add(this.update,this),this._isConnectedToTicker=!0)},D.prototype._onPlayStop=function(){this._isConnectedToTicker&&(n.a.shared.remove(this.update,this),this._isConnectedToTicker=!1)},D.prototype._onCanPlay=function(){var e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);var t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()},D.prototype.dispose=function(){this._isConnectedToTicker&&(n.a.shared.remove(this.update,this),this._isConnectedToTicker=!1);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),d.prototype.dispose.call(this)},Object.defineProperty(D.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(n.a.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(n.a.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(e){e!==this._updateFPS&&(this._updateFPS=e)},enumerable:!1,configurable:!0}),D.test=function(e,t){return self.HTMLVideoElement&&e instanceof HTMLVideoElement||-1<D.TYPES.indexOf(t)},D.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],D.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},D),r=(a(U,l=O),U.test=function(e){return!!self.createImageBitmap&&e instanceof ImageBitmap},U);function U(e){return l.call(this,e)||this}function D(e,t){var r=this;if(t=t||{},!(e instanceof HTMLVideoElement)){var i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","");var n=(e="string"==typeof e?[e]:e)[0].src||e[0];O.crossOrigin(i,n,t.crossorigin);for(var o=0;o<e.length;++o){var s=document.createElement("source"),a=e[o],u=a.src,h=a.mime,a=(u=u||e[o]).split("?").shift().toLowerCase(),a=a.substr(a.lastIndexOf(".")+1),h=h||D.MIME_TYPES[a]||"video/"+a;s.src=u,s.type=h,i.appendChild(s)}e=i}return(r=d.call(this,e)||this).noSubImage=!0,r._autoUpdate=!0,r._isConnectedToTicker=!1,r._updateFPS=t.updateFPS||0,r._msToNextUpdate=0,r.autoPlay=!1!==t.autoPlay,r._load=null,r._resolve=null,r._onCanPlay=r._onCanPlay.bind(r),r._onError=r._onError.bind(r),!1!==t.autoLoad&&r.load(),r}function L(e,t){var r=this;return t=t||{},(r=f.call(this,document.createElement("canvas"))||this)._width=0,r._height=0,r.svg=e,r.scale=t.scale||1,r._overrideWidth=t.width,r._overrideHeight=t.height,r._resolve=null,r._crossorigin=t.crossorigin,r._load=null,!1!==t.autoLoad&&r.load(),r}function G(e,t){var r,i=this;return t=t||{},e instanceof HTMLImageElement||(r=new Image,O.crossOrigin(r,e,t.crossorigin),r.src=e,e=r),i=c.call(this,e)||this,!e.complete&&i._width&&i._height&&(i._width=0,i._height=0),i.url=e.src,i._process=null,i.preserveBitmap=!1,i.createBitmap=(void 0!==t.createBitmap?t.createBitmap:p.b.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,i.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,i.bitmap=null,i._load=null,!1!==t.autoLoad&&i.load(),i}function k(e,t){var r=this,i=t||{},n=i.width,o=i.height,s=i.autoLoad,i=i.linkBaseTexture;if(e&&e.length!==k.SIDES)throw new Error("Invalid length. Got "+e.length+", expected 6");for(var r=y.call(this,6,{width:n,height:o})||this,a=0;a<k.SIDES;a++)r.items[a].target=m.q.TEXTURE_CUBE_MAP_POSITIVE_X+a;return r.linkBaseTexture=!1!==i,e&&r.initFromArray(e,t),!1!==s&&r.load(),r}function j(e){return _.call(this,e)||this}function V(e){var t=this,r=e.naturalWidth||e.videoWidth||e.width,i=e.naturalHeight||e.videoHeight||e.height;return(t=b.call(this,r,i)||this).source=e,t.noSubImage=!1,t}function H(e,t){var r,i=this,n=t||{},o=n.width,n=n.height,e=Array.isArray(e)?(r=e).length:e,i=x.call(this,e,{width:o,height:n})||this;return r&&i.initFromArray(r,t),i}function X(e,t){var r=this,i=t||{},t=i.width,i=i.height;(r=E.call(this,t,i)||this).items=[],r.itemDirtyIds=[];for(var n=0;n<e;n++){var o=new I;r.items.push(o),r.itemDirtyIds.push(-2)}return r.length=e,r._load=null,r.baseTexture=null,r}function z(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var r=T.call(this)||this,i=(t=t||{}).alphaMode,n=t.mipmap,o=t.anisotropicLevel,s=t.scaleMode,a=t.width,u=t.height,h=t.wrapMode,l=t.format,d=t.type,f=t.target,c=t.resolution,t=t.resourceOptions;return!e||e instanceof S||((e=g(e,t)).internal=!0),r.resolution=c||p.b.RESOLUTION,r.width=Math.round((a||0)*r.resolution)/r.resolution,r.height=Math.round((u||0)*r.resolution)/r.resolution,r._mipmap=void 0!==n?n:p.b.MIPMAP_TEXTURES,r.anisotropicLevel=void 0!==o?o:p.b.ANISOTROPIC_LEVEL,r._wrapMode=h||p.b.WRAP_MODE,r._scaleMode=void 0!==s?s:p.b.SCALE_MODE,r.format=l||m.h.RGBA,r.type=d||m.r.UNSIGNED_BYTE,r.target=f||m.q.TEXTURE_2D,r.alphaMode=void 0!==i?i:m.a.UNPACK,r.uid=Object(v.D)(),r.touched=0,r.isPowerOfTwo=!1,r._refreshPOT(),r._glTextures={},r.dirtyId=0,r.dirtyStyleId=0,r.cacheId=null,r.valid=0<a&&0<u,r.textureCacheIds=[],r.destroyed=!1,r.resource=null,r._batchEnabled=0,r._batchLocation=0,r.parentTextureArray=null,r.setResource(e),r}function W(e,t){var r=this,i=t||{},t=i.width,i=i.height;if(!t||!i)throw new Error("BufferResource width or height invalid");return(r=R.call(this,t,i)||this).data=e,r}function Y(e,t){void 0===t&&(t=0),this._width=e=void 0===e?0:e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new i.a("setRealSize"),this.onUpdate=new i.a("update"),this.onError=new i.a("onError")}s.push(B,r,N,t,P,w,M,F);var K,q,Z,$={__proto__:null,Resource:S,BaseImageResource:O,INSTALLED:s,autoDetectResource:g,AbstractMultiResource:C,ArrayResource:F,BufferResource:w,CanvasResource:N,CubeResource:M,ImageResource:B,SVGResource:P,VideoResource:t,ImageBitmapResource:r},J=(a(ue,Z=w),ue.prototype.upload=function(e,t,r){var i=e.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===m.a.UNPACK);var n=t.realWidth,e=t.realHeight;return r.width===n&&r.height===e?i.texSubImage2D(t.target,0,0,0,n,e,t.format,r.type,this.data):(r.width=n,r.height=e,i.texImage2D(t.target,0,r.internalFormat,n,e,0,t.format,r.type,this.data)),!0},ue),Q=(Object.defineProperty(ae.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),ae.prototype.addColorTexture=function(e,t){return this.colorTextures[e=void 0===e?0:e]=t||new I(null,{scaleMode:m.p.NEAREST,resolution:1,mipmap:m.k.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},ae.prototype.addDepthTexture=function(e){return this.depthTexture=e||new I(new J(null,{width:this.width,height:this.height}),{scaleMode:m.p.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:m.k.OFF,format:m.h.DEPTH_COMPONENT,type:m.r.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},ae.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},ae.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},ae.prototype.resize=function(e,t){if(e=Math.round(e),t=Math.round(t),e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var i=this.colorTextures[r],n=i.resolution;i.setSize(e/n,t/n)}this.depthTexture&&(n=this.depthTexture.resolution,this.depthTexture.setSize(e/n,t/n))}},ae.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},ae.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},ae),ee=(a(se,q=I),se.prototype.resize=function(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},se.prototype.dispose=function(){this.framebuffer.dispose(),q.prototype.dispose.call(this)},se.prototype.destroy=function(){q.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},se),te=(oe.prototype.set=function(e,t,r){var i,n,o,s=t.width,a=t.height;r?(i=e.width/2/s,n=e.height/2/a,o=e.x/s+i,t=e.y/a+n,r=u.n.add(r,u.n.NW),this.x0=o+i*u.n.uX(r),this.y0=t+n*u.n.uY(r),r=u.n.add(r,2),this.x1=o+i*u.n.uX(r),this.y1=t+n*u.n.uY(r),r=u.n.add(r,2),this.x2=o+i*u.n.uX(r),this.y2=t+n*u.n.uY(r),r=u.n.add(r,2),this.x3=o+i*u.n.uX(r),this.y3=t+n*u.n.uY(r)):(this.x0=e.x/s,this.y0=e.y/a,this.x1=(e.x+e.width)/s,this.y1=e.y/a,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/a,this.x3=e.x/s,this.y3=(e.y+e.height)/a),this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},oe.prototype.toString=function(){return"[@pixi/core:TextureUvs x0="+this.x0+" y0="+this.y0+" x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+" x3="+this.x3+" y3="+this.y3+"]"},oe),re=new te,ie=(a(ne,K=v.c),ne.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},ne.prototype.onBaseTextureUpdated=function(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},ne.prototype.destroy=function(e){this.baseTexture&&(e&&((e=this.baseTexture.resource)&&e.url&&v.e[e.url]&&ne.removeFromCache(e.url),this.baseTexture.destroy()),this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,ne.removeFromCache(this),this.textureCacheIds=null},ne.prototype.clone=function(){var e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),t=new ne(this.baseTexture,!this.noFrame&&e,t,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(t._frame=e),t},ne.prototype.updateUvs=function(){this._uvs===re&&(this._uvs=new te),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},ne.from=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=p.b.STRICT_TEXTURE_CACHE);var i="string"==typeof e,n=null,n=i?e:e instanceof I?(e.cacheId||(o=t&&t.pixiIdPrefix||"pixiid",e.cacheId=o+"-"+Object(v.D)(),I.addToCache(e,e.cacheId)),e.cacheId):(e._pixiId||(o=t&&t.pixiIdPrefix||"pixiid",e._pixiId=o+"_"+Object(v.D)()),e._pixiId),o=v.e[n];if(i&&r&&!o)throw new Error('The cacheId "'+n+'" does not exist in TextureCache.');return o||e instanceof I?!o&&e instanceof I&&(o=new ne(e),ne.addToCache(o,n)):(t.resolution||(t.resolution=Object(v.l)(e)),(o=new ne(new I(e,t))).baseTexture.cacheId=n,I.addToCache(o.baseTexture,n),ne.addToCache(o,n)),o},ne.fromURL=function(e,t){var r=Object.assign({autoLoad:!1},null==t?void 0:t.resourceOptions),i=ne.from(e,Object.assign({resourceOptions:r},t),!1),t=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):t.load().then(function(){return Promise.resolve(i)})},ne.fromBuffer=function(e,t,r,i){return new ne(I.fromBuffer(e,t,r,i))},ne.fromLoader=function(e,t,r,i){e=new I(e,Object.assign({scaleMode:p.b.SCALE_MODE,resolution:Object(v.l)(t)},i)),i=e.resource;i instanceof B&&(i.url=t);var n=new ne(e);return I.addToCache(n.baseTexture,r=r||t),ne.addToCache(n,r),r!==t&&(I.addToCache(n.baseTexture,t),ne.addToCache(n,t)),n.baseTexture.valid?Promise.resolve(n):new Promise(function(e){n.baseTexture.once("loaded",function(){return e(n)})})},ne.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),v.e[t],v.e[t]=e)},ne.removeFromCache=function(e){if("string"==typeof e){var t=v.e[e];if(t){var r=t.textureCacheIds.indexOf(e);return-1<r&&t.textureCacheIds.splice(r,1),delete v.e[e],t}}else if(e&&e.textureCacheIds){for(var i=0;i<e.textureCacheIds.length;++i)v.e[e.textureCacheIds[i]]===e&&delete v.e[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null},Object.defineProperty(ne.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"frame",{get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1;var t=e.x,r=e.y,i=e.width,n=e.height,o=t+i>this.baseTexture.width,s=r+n>this.baseTexture.height;if(o||s){t="X: "+t+" + "+i+" = "+(t+i)+" > "+this.baseTexture.width,r="Y: "+r+" + "+n+" = "+(r+n)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+t+" "+(o&&s?"and":"or")+" "+r)}this.valid=i&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=e),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),ne.prototype.castToBaseTexture=function(){return this.baseTexture},ne);function ne(e,t,r,i,n,o){var s=K.call(this)||this;if(s.noFrame=!1,t||(s.noFrame=!0,t=new u.j(0,0,1,1)),e instanceof ne&&(e=e.baseTexture),s.baseTexture=e,s._frame=t,s.trim=i,s.valid=!1,s._uvs=re,s.uvMatrix=null,s.orig=r||t,s._rotate=Number(n||0),!0===n)s._rotate=2;else if(s._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return s.defaultAnchor=o?new u.g(o.x,o.y):new u.g(0,0),s._updateID=0,s.textureCacheIds=[],e.valid?s.noFrame?e.valid&&s.onBaseTextureUpdated(e):s.frame=t:e.once("loaded",s.onBaseTextureUpdated,s),s.noFrame&&e.on("update",s.onBaseTextureUpdated,s),s}function oe(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}function se(e){var t=this;return(e="number"==typeof e?{width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}:e).width=e.width||100,e.height=e.height||100,e.multisample=void 0!==e.multisample?e.multisample:m.l.NONE,(t=q.call(this,null,e)||this).mipmap=m.k.OFF,t.valid=!0,t.clearColor=[0,0,0,0],t.framebuffer=new Q(t.realWidth,t.realHeight).addColorTexture(0,t),t.framebuffer.multisample=e.multisample,t.maskStack=[],t.filterStack=[{}],t}function ae(e,t){this.width=Math.round(e||100),this.height=Math.round(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new i.a("disposeFramebuffer"),this.multisample=m.l.NONE}function ue(){return null!==Z&&Z.apply(this,arguments)||this}function he(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}ie.EMPTY=new ie(new I),he(ie.EMPTY),he(ie.EMPTY.baseTexture),ie.WHITE=function(){var e=document.createElement("canvas");e.width=16,e.height=16;var t=e.getContext("2d");return t.fillStyle="white",t.fillRect(0,0,16,16),new ie(new I(new N(e)))}(),he(ie.WHITE),he(ie.WHITE.baseTexture);var le,de=(a(be,le=ie),Object.defineProperty(be.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(e){this.framebuffer.multisample=e},enumerable:!1,configurable:!0}),be.prototype.resize=function(e,t,r){void 0===r&&(r=!0);var i=this.baseTexture.resolution,e=Math.round(e*i)/i,i=Math.round(t*i)/i;this.valid=0<e&&0<i,this._frame.width=this.orig.width=e,this._frame.height=this.orig.height=i,r&&this.baseTexture.resize(e,i),this.updateUvs()},be.prototype.setResolution=function(e){var t=this.baseTexture;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))},be.create=function(e){for(var t=arguments,r=[],i=1;i<arguments.length;i++)r[i-1]=t[i];return"number"==typeof e&&(Object(v.h)("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),e={width:e,height:r[0],scaleMode:r[1],resolution:r[2]}),new be(new ee(e))},be),fe=(_e.prototype.createTexture=function(e,t,r){void 0===r&&(r=m.l.NONE);r=new ee(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions));return new de(r)},_e.prototype.getOptimalTexture=function(e,t,r,i){var n;void 0===r&&(r=1),void 0===i&&(i=m.l.NONE),e=Math.ceil(e*r),t=Math.ceil(t*r),this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight?n=1<i?-i:-1:(n=((65535&(e=Object(v.s)(e)))<<16|65535&(t=Object(v.s)(t)))>>>0,1<i&&(n+=4294967296*i)),this.texturePool[n]||(this.texturePool[n]=[]);var o=this.texturePool[n].pop();return(o=o||this.createTexture(e,t,i)).filterPoolKey=n,o.setResolution(r),o},_e.prototype.getFilterTexture=function(e,t,r){r=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||m.l.NONE);return r.filterFrame=e.filterFrame,r},_e.prototype.returnTexture=function(e){var t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)},_e.prototype.returnFilterTexture=function(e){this.returnTexture(e)},_e.prototype.clear=function(e){if(e=!1!==e)for(var t in this.texturePool){var r=this.texturePool[t];if(r)for(var i=0;i<r.length;i++)r[i].destroy(!0)}this.texturePool={}},_e.prototype.setScreenSize=function(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){for(var t in this.enableFullScreen=0<e.width&&0<e.height,this.texturePool)if(Number(t)<0){var r=this.texturePool[t];if(r)for(var i=0;i<r.length;i++)r[i].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}},_e.SCREEN_KEY=-1,_e),ce=(ye.prototype.destroy=function(){this.buffer=null},ye.from=function(e,t,r,i,n){return new ye(e,t,r,i,n)},ye),pe=0,me=(ge.prototype.update=function(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++},ge.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},ge.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(ge.prototype,"index",{get:function(){return this.type===m.d.ELEMENT_ARRAY_BUFFER},set:function(e){this.type=e?m.d.ELEMENT_ARRAY_BUFFER:m.d.ARRAY_BUFFER},enumerable:!1,configurable:!0}),ge.from=function(e){return new ge(e=e instanceof Array?new Float32Array(e):e)},ge),ve={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function ge(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=pe++,this.disposeRunner=new i.a("disposeBuffer")}function ye(e,t,r,i,n,o,s){void 0===t&&(t=0),void 0===r&&(r=!1),void 0===i&&(i=m.r.FLOAT),this.buffer=e,this.size=t,this.normalized=r,this.type=i,this.stride=n,this.start=o,this.instance=s}function _e(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}function be(e,t){t=le.call(this,e,t)||this;return t.valid=!0,t.filterFrame=null,t.filterPoolKey=null,t.updateUvs(),t}var xe,Ee,Te={5126:4,5123:2,5121:1},Re=0,Se={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},we=(rt.prototype.addAttribute=function(e,t,r,i,n,o,s,a){if(void 0===r&&(r=0),void 0===i&&(i=!1),void 0===a&&(a=!1),!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof me||(t instanceof Array&&(t=new Float32Array(t)),t=new me(t));var u=e.split("|");if(1<u.length){for(var h=0;h<u.length;h++)this.addAttribute(u[h],t,r,i,n);return this}var l=this.buffers.indexOf(t);return-1===l&&(this.buffers.push(t),l=this.buffers.length-1),this.attributes[e]=new ce(l,r,i,n,o,s,a),this.instanced=this.instanced||a,this},rt.prototype.getAttribute=function(e){return this.attributes[e]},rt.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},rt.prototype.addIndex=function(e){return e instanceof me||(e instanceof Array&&(e=new Uint16Array(e)),e=new me(e)),e.type=m.d.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,-1===this.buffers.indexOf(e)&&this.buffers.push(e),this},rt.prototype.getIndex=function(){return this.indexBuffer},rt.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var e,t=[],r=[],i=new me;for(e in this.attributes){var n=this.attributes[e],o=this.buffers[n.buffer];t.push(o.data),r.push(n.size*Te[n.type]/4),n.buffer=0}for(i.data=function(e,t){for(var r=0,i=0,n={},o=0;o<e.length;o++)i+=t[o],r+=e[o].length;for(var s=new ArrayBuffer(4*r),a=null,u=0,o=0;o<e.length;o++){var h=t[o],l=e[o],d=Object(v.k)(l);n[d]||(n[d]=new ve[d](s));for(var a=n[d],f=0;f<l.length;f++)a[(f/h|0)*i+u+f%h]=l[f];u+=h}return new Float32Array(s)}(t,r),e=0;e<this.buffers.length;e++)this.buffers[e]!==this.indexBuffer&&this.buffers[e].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},rt.prototype.getSize=function(){for(var e in this.attributes){e=this.attributes[e];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},rt.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},rt.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},rt.prototype.clone=function(){for(var e=new rt,t=0;t<this.buffers.length;t++)e.buffers[t]=new me(this.buffers[t].data.slice(0));for(t in this.attributes){var r=this.attributes[t];e.attributes[t]=new ce(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=m.d.ELEMENT_ARRAY_BUFFER),e},rt.merge=function(e){for(var t=new rt,r=[],i=[],n=[],o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.buffers.length;a++)i[a]=i[a]||0,i[a]+=s.buffers[a].data.length,n[a]=0;for(o=0;o<s.buffers.length;o++)r[o]=new Se[Object(v.k)(s.buffers[o].data)](i[o]),t.buffers[o]=new me(r[o]);for(o=0;o<e.length;o++)for(s=e[o],a=0;a<s.buffers.length;a++)r[a].set(s.buffers[a].data,n[a]),n[a]+=s.buffers[a].data.length;if(t.attributes=s.attributes,s.indexBuffer){t.indexBuffer=t.buffers[s.buffers.indexOf(s.indexBuffer)],t.indexBuffer.type=m.d.ELEMENT_ARRAY_BUFFER;var u=0,h=0,l=0,d=0;for(o=0;o<s.buffers.length;o++)if(s.buffers[o]!==s.indexBuffer){d=o;break}for(o in s.attributes){var f=s.attributes[o];(0|f.buffer)===d&&(h+=f.size*Te[f.type]/4)}for(o=0;o<e.length;o++){for(var c=e[o].indexBuffer.data,a=0;a<c.length;a++)t.indexBuffer.data[a+l]+=u;u+=e[o].buffers[d].data.length/h,l+=c.length}}return t},rt),Ae=(a(tt,Ee=we),tt),Ie=(a(et,xe=we),et.prototype.map=function(e,t){var r;return this.uvs[0]=0,this.uvs[1]=0,this.uvs[2]=0+t.width/e.width,this.uvs[3]=0,this.uvs[4]=0+t.width/e.width,this.uvs[5]=0+t.height/e.height,this.uvs[6]=0,this.uvs[7]=0+t.height/e.height,r=t.x,e=t.y,this.vertices[0]=r,this.vertices[1]=e,this.vertices[2]=r+t.width,this.vertices[3]=e,this.vertices[4]=r+t.width,this.vertices[5]=e+t.height,this.vertices[6]=r,this.vertices[7]=e+t.height,this.invalidate(),this},et.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},et),Ce=0,Fe=(Qe.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},Qe.prototype.add=function(e,t,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new Qe(t,r)},Qe.from=function(e,t,r){return new Qe(e,t,r)},Qe.uboFrom=function(e,t){return new Qe(e,null==t||t,!0)},Qe),Oe=(Je.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},Je),Ne=[new u.g,new u.g,new u.g,new u.g],Me=new u.d,Be=($e.prototype.push=function(e,t){for(var r,i,n=this.renderer,o=this.defaultFilterStack,s=this.statePool.pop()||new Oe,a=this.renderer.renderTexture,u=t[0].resolution,h=t[0].multisample,l=t[0].padding,d=t[0].autoFit,f=null===(r=t[0].legacy)||void 0===r||r,c=1;c<t.length;c++)var p=t[c],u=Math.min(u,p.resolution),h=Math.min(h,p.multisample),l=this.useMaxPadding?Math.max(l,p.padding):l+p.padding,d=d&&p.autoFit,f=f||null===(i=p.legacy)||void 0===i||i;1===o.length&&(this.defaultFilterStack[0].renderTexture=a.current),o.push(s),s.resolution=u,s.multisample=h,s.legacy=f,s.target=e,s.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),s.sourceFrame.pad(l),d&&(m=this.tempRect.copyFrom(a.sourceFrame),n.projection.transform&&this.transformAABB(Me.copyFrom(n.projection.transform).invert(),m),s.sourceFrame.fit(m)),this.roundFrame(s.sourceFrame,(a.current||n).resolution,a.sourceFrame,a.destinationFrame,n.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,u,h),s.filters=t,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;var m=this.tempRect;m.x=0,m.y=0,m.width=s.sourceFrame.width,m.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(a.sourceFrame),s.bindingDestinationFrame.copyFrom(a.destinationFrame),s.transform=n.projection.transform,n.projection.transform=null,a.bind(s.renderTexture,s.sourceFrame,m),n.framebuffer.clear(0,0,0,0)},$e.prototype.pop=function(){var e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;var i=this.globalUniforms.uniforms;i.outputFrame=t.sourceFrame,i.resolution=t.resolution;var n=i.inputSize,o=i.inputPixel,s=i.inputClamp;n[0]=t.destinationFrame.width,n[1]=t.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*t.resolution),o[1]=Math.round(n[1]*t.resolution),o[2]=1/o[0],o[3]=1/o[1],s[0]=.5*o[2],s[1]=.5*o[3],s[2]=t.sourceFrame.width*n[2]-.5*o[2],s[3]=t.sourceFrame.height*n[3]-.5*o[3],t.legacy&&((o=i.filterArea)[0]=t.destinationFrame.width,o[1]=t.destinationFrame.height,o[2]=t.sourceFrame.x,o[3]=t.sourceFrame.y,i.filterClamp=i.inputClamp),this.globalUniforms.update();e=e[e.length-1];if(this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,t.renderTexture,e.renderTexture,m.e.BLEND,t),this.returnFilterTexture(t.renderTexture);else{var a=t.renderTexture;(l=this.getOptimalFilterTexture(a.width,a.height,t.resolution)).filterFrame=a.filterFrame;for(var u=0,u=0;u<r.length-1;++u){1===u&&1<t.multisample&&((l=this.getOptimalFilterTexture(a.width,a.height,t.resolution)).filterFrame=a.filterFrame),r[u].apply(this,a,l,m.e.CLEAR,t);var h=a,a=l,l=h}r[u].apply(this,a,e.renderTexture,m.e.BLEND,t),1<u&&1<t.multisample&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(a),this.returnFilterTexture(l)}t.clear(),this.statePool.push(t)},$e.prototype.bindAndClear=function(e,t){void 0===t&&(t=m.e.CLEAR);var r=this.renderer,i=r.renderTexture,n=r.state;e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e&&e.filterFrame?((r=this.tempRect).x=0,r.y=0,r.width=e.filterFrame.width,r.height=e.filterFrame.height,i.bind(e,e.filterFrame,r)):e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);n=1&n.stateId||this.forceClear;(t===m.e.CLEAR||t===m.e.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)},$e.prototype.applyFilter=function(e,t,r,i){var n=this.renderer;n.state.set(e.state),this.bindAndClear(r,i),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(m.f.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(m.f.TRIANGLE_STRIP))},$e.prototype.calculateSpriteMatrix=function(e,t){var r=this.activeState,i=r.sourceFrame,n=r.destinationFrame,r=t._texture.orig,n=e.set(n.width,0,0,n.height,i.x,i.y),i=t.worldTransform.copyTo(u.d.TEMP_MATRIX);return i.invert(),n.prepend(i),n.scale(1/r.width,1/r.height),n.translate(t.anchor.x,t.anchor.y),n},$e.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},$e.prototype.getOptimalFilterTexture=function(e,t,r,i){return void 0===i&&(i=m.l.NONE),this.texturePool.getOptimalTexture(e,t,r=void 0===r?1:r,i)},$e.prototype.getFilterTexture=function(e,t,r){var i;"number"==typeof e&&(i=e,e=t,t=i),e=e||this.activeState.renderTexture;r=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||m.l.NONE);return r.filterFrame=e.filterFrame,r},$e.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},$e.prototype.emptyPool=function(){this.texturePool.clear(!0)},$e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},$e.prototype.transformAABB=function(e,t){var r=Ne[0],i=Ne[1],n=Ne[2],o=Ne[3];r.set(t.left,t.top),i.set(t.left,t.bottom),n.set(t.right,t.top),o.set(t.right,t.bottom),e.apply(r,r),e.apply(i,i),e.apply(n,n),e.apply(o,o);var s=Math.min(r.x,i.x,n.x,o.x),a=Math.min(r.y,i.y,n.y,o.y),e=Math.max(r.x,i.x,n.x,o.x),o=Math.max(r.y,i.y,n.y,o.y);t.x=s,t.y=a,t.width=e-s,t.height=o-a},$e.prototype.roundFrame=function(e,t,r,i,n){if(n){var o=n.a,s=n.b,a=n.c,u=n.d;if((1e-4<Math.abs(s)||1e-4<Math.abs(a))&&(1e-4<Math.abs(o)||1e-4<Math.abs(u)))return}(n=n?Me.copyFrom(n):Me.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(n,e),e.ceil(t),this.transformAABB(n.invert(),e)},$e),Pe=(Ze.prototype.flush=function(){},Ze.prototype.destroy=function(){this.renderer=null},Ze.prototype.start=function(){},Ze.prototype.stop=function(){this.flush()},Ze.prototype.render=function(e){},Ze),Ue=(qe.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},qe.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},qe.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},qe.prototype.copyBoundTextures=function(e,t){for(var r=this.renderer.texture.boundTextures,i=t-1;0<=i;--i)e[i]=r[i]||null,e[i]&&(e[i]._batchLocation=i)},qe.prototype.boundArray=function(e,t,r,i){for(var n=e.elements,o=e.ids,s=e.count,a=0,u=0;u<s;u++){var h=n[u],l=h._batchLocation;if(0<=l&&l<i&&t[l]===h)o[u]=l;else for(;a<i;){var d=t[a];if(!d||d._batchEnabled!==r||d._batchLocation!==a){o[u]=a,t[h._batchLocation=a]=h;break}a++}}},qe.prototype.destroy=function(){this.renderer=null},qe),De=0,Le=(Object.defineProperty(Ke.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),Ke.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=De++,e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext()},Ke.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=De++,this.renderer.runners.contextChange.emit(e)},Ke.prototype.initFromOptions=function(e){e=this.createContext(this.renderer.view,e);this.initFromContext(e)},Ke.prototype.createContext=function(e,t){var r;if(r=p.b.PREFER_ENV>=m.g.WEBGL2?e.getContext("webgl2",t):r)this.webGLVersion=2;else if(this.webGLVersion=1,!(r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl},Ke.prototype.getExtensions=function(){var e=this.gl,t={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),loseContext:e.getExtension("WEBGL_lose_context"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})},Ke.prototype.handleContextLost=function(e){e.preventDefault()},Ke.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},Ke.prototype.destroy=function(){var e=this.renderer.view;this.renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},Ke.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},Ke.prototype.validateContext=function(e){var t=e.getContextAttributes(),r="WebGL2RenderingContext"in self&&e instanceof self.WebGL2RenderingContext;r&&(this.webGLVersion=2),t.stencil;e=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=e},Ke),Ge=function(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=m.l.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0},ke=new u.j,je=(Ye.prototype.contextChange=function(){var t,e,r=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new u.j,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion?(t=this.renderer.context.extensions.drawBuffers,e=this.renderer.context.extensions.depthTexture,p.b.PREFER_ENV===m.g.WEBGL_LEGACY&&(e=t=null),t?r.drawBuffers=function(e){return t.drawBuffersWEBGL(e)}:(this.hasMRT=!1,r.drawBuffers=function(){}),e||(this.writeDepthTexture=!1)):this.msaaSamples=r.getInternalformatParameter(r.RENDERBUFFER,r.RGBA8,r.SAMPLES)},Ye.prototype.bind=function(e,t,r){void 0===r&&(r=0);var i=this.gl;if(e){var n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var o,s,a=0;a<e.colorTextures.length;a++){var u=e.colorTextures[a];this.renderer.texture.unbind(u.parentTextureArray||u)}e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t?(o=t.width>>r,s=t.height>>r,n=o/t.width,this.setViewport(t.x*n,t.y*n,o,s)):(o=e.width>>r,s=e.height>>r,this.setViewport(0,0,o,s))}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},Ye.prototype.setViewport=function(e,t,r,i){var n=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),i=Math.round(i),n.width===r&&n.height===i&&n.x===e&&n.y===t||(n.x=e,n.y=t,n.width=r,n.height=i,this.gl.viewport(e,t,r,i))},Object.defineProperty(Ye.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),Ye.prototype.clear=function(e,t,r,i,n){void 0===n&&(n=m.c.COLOR|m.c.DEPTH);var o=this.gl;o.clearColor(e,t,r,i),o.clear(n)},Ye.prototype.initFramebuffer=function(e){var t=this.gl,t=new Ge(t.createFramebuffer());return t.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=t,this.managedFramebuffers.push(e),e.disposeRunner.add(this),t},Ye.prototype.resizeFramebuffer=function(e){var t=this.gl,r=e.glFramebuffers[this.CONTEXT_UID];r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,t.RGBA8,e.width,e.height)),r.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,r.stencil),r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));var i=e.colorTextures,n=i.length;t.drawBuffers||(n=Math.min(n,1));for(var o=0;o<n;o++){var s=i[o],s=s.parentTextureArray||s;this.renderer.texture.bind(s,0)}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)},Ye.prototype.updateFramebuffer=function(e,t){var r=this.gl,i=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures,o=n.length;r.drawBuffers||(o=Math.min(o,1)),1<i.multisample&&this.canMultisampleFramebuffer(e)?(i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.RGBA8,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));for(var s,a=[],u=0;u<o;u++){var h=n[u],l=h.parentTextureArray||h;this.renderer.texture.bind(l,0),0===u&&i.msaaBuffer||(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+u,h.target,l._glTextures[this.CONTEXT_UID].texture,t),a.push(r.COLOR_ATTACHMENT0+u))}1<a.length&&r.drawBuffers(a),!e.depthTexture||this.writeDepthTexture&&(s=e.depthTexture,this.renderer.texture.bind(s,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,t)),!e.stencil&&!e.depth||e.depthTexture&&this.writeDepthTexture?i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null):(i.stencil=i.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,i.stencil))},Ye.prototype.canMultisampleFramebuffer=function(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture},Ye.prototype.detectSamples=function(e){var t=this.msaaSamples,r=m.l.NONE;if(e<=1||null===t)return r;for(var i=0;i<t.length;i++)if(t[i]<=e){r=t[i];break}return r=1===r?m.l.NONE:r},Ye.prototype.blit=function(e,t,r){var i=this.current,n=this.renderer,o=this.gl,s=this.CONTEXT_UID;if(2===n.context.webGLVersion&&i){n=i.glFramebuffers[s];if(n){if(!e){if(!n.msaaBuffer)return;s=i.colorTextures[0];if(!s)return;n.blitFramebuffer||(n.blitFramebuffer=new Q(i.width,i.height),n.blitFramebuffer.addColorTexture(0,s)),(e=n.blitFramebuffer).colorTextures[0]!==s&&(e.colorTextures[0]=s,e.dirtyId++,e.dirtyFormat++),e.width===i.width&&e.height===i.height||(e.width=i.width,e.height=i.height,e.dirtyId++,e.dirtySize++)}t||((t=ke).width=i.width,t.height=i.height);i=t.width===(r=r||t).width&&t.height===r.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,n.framebuffer),o.blitFramebuffer(t.x,t.y,t.width,t.height,r.x,r.y,r.width,r.height,o.COLOR_BUFFER_BIT,i?o.NEAREST:o.LINEAR)}}},Ye.prototype.disposeFramebuffer=function(e,t){var r,i=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;i&&(delete e.glFramebuffers[this.CONTEXT_UID],0<=(r=this.managedFramebuffers.indexOf(e))&&this.managedFramebuffers.splice(r,1),e.disposeRunner.remove(this),t||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose())},Ye.prototype.disposeAll=function(e){var t=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)},Ye.prototype.forceStencil=function(){var e,t,r,i,n=this.current;!n||(e=n.glFramebuffers[this.CONTEXT_UID])&&!e.stencil&&(n.stencil=!0,t=n.width,r=n.height,n=(i=this.gl).createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n),e.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,e.multisample,i.DEPTH24_STENCIL8,t,r):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,r),e.stencil=n,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n))},Ye.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new u.j},Ye.prototype.destroy=function(){this.renderer=null},Ye),Ve={5126:4,5123:2,5121:1},He=(We.prototype.contextChange=function(){this.disposeAll(!0);var t,o,e=this.gl=this.renderer.gl,r=this.renderer.context;this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==r.webGLVersion&&(t=this.renderer.context.extensions.vertexArrayObject,(t=p.b.PREFER_ENV===m.g.WEBGL_LEGACY?null:t)?(e.createVertexArray=function(){return t.createVertexArrayOES()},e.bindVertexArray=function(e){return t.bindVertexArrayOES(e)},e.deleteVertexArray=function(e){return t.deleteVertexArrayOES(e)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})),2!==r.webGLVersion&&((o=e.getExtension("ANGLE_instanced_arrays"))?(e.vertexAttribDivisor=function(e,t){return o.vertexAttribDivisorANGLE(e,t)},e.drawElementsInstanced=function(e,t,r,i,n){return o.drawElementsInstancedANGLE(e,t,r,i,n)},e.drawArraysInstanced=function(e,t,r,i){return o.drawArraysInstancedANGLE(e,t,r,i)}):this.hasInstance=!1),this.canUseUInt32ElementIndex=2===r.webGLVersion||!!r.extensions.uint32ElementIndex},We.prototype.bind=function(e,t){t=t||this.renderer.shader.shader;var r=this.gl,i=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;i||((this.managedGeometries[e.id]=e).disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=i={},n=!0);n=i[t.program.id]||this.initGeometryVao(e,t,n);this._activeGeometry=e,this._activeVao!==n&&(this._activeVao=n,this.hasVao?r.bindVertexArray(n):this.activateVao(e,t.program)),this.updateBuffers()},We.prototype.reset=function(){this.unbind()},We.prototype.updateBuffers=function(){for(var e=this._activeGeometry,t=this.renderer.buffer,r=0;r<e.buffers.length;r++){var i=e.buffers[r];t.update(i)}},We.prototype.checkCompatibility=function(e,t){var r,i=e.attributes;for(r in t.attributeData)if(!i[r])throw new Error('shader and geometry incompatible, geometry missing the "'+r+'" attribute')},We.prototype.getSignature=function(e,t){var r,i=e.attributes,n=t.attributeData,o=["g",e.id];for(r in i)n[r]&&o.push(r,n[r].location);return o.join("-")},We.prototype.initGeometryVao=function(e,t,r){void 0===r&&(r=!0);var i=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,s=t.program;s.glPrograms[n]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,s);var a=this.getSignature(e,s),u=e.glVertexArrayObjects[this.CONTEXT_UID],t=u[a];if(t)return u[s.id]=t;var h,l=e.buffers,d=e.attributes,f={},c={};for(h in l)f[h]=0,c[h]=0;for(h in d)!d[h].size&&s.attributeData[h]?d[h].size=s.attributeData[h].size:d[h].size,f[d[h].buffer]+=d[h].size*Ve[d[h].type];for(h in d){var p=d[h],m=p.size;void 0===p.stride&&(f[p.buffer]===m*Ve[p.type]?p.stride=0:p.stride=f[p.buffer]),void 0===p.start&&(p.start=c[p.buffer],c[p.buffer]+=m*Ve[p.type])}t=i.createVertexArray(),i.bindVertexArray(t);for(var v=0;v<l.length;v++){var g=l[v];o.bind(g),r&&g._glBuffers[n].refCount++}return this.activateVao(e,s),this._activeVao=t,u[s.id]=t,u[a]=t},We.prototype.disposeGeometry=function(e,t){var r;if(this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var i=e.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,o=e.buffers,s=null===(r=this.renderer)||void 0===r?void 0:r.buffer;if(e.disposeRunner.remove(this),i){if(s)for(var a=0;a<o.length;a++){var u=o[a]._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,0!==u.refCount||t||s.dispose(o[a],t))}if(!t)for(var h in i)"g"===h[0]&&(h=i[h],this._activeVao===h&&this.unbind(),n.deleteVertexArray(h));delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},We.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedGeometries),r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)},We.prototype.activateVao=function(e,t){var r=this.gl,i=this.CONTEXT_UID,n=this.renderer.buffer,o=e.buffers,s=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);var a,u=null;for(a in s){var h=s[a],l=o[h.buffer],d=l._glBuffers[i];if(t.attributeData[a]){u!==d&&(n.bind(l),u=d);d=t.attributeData[a].location;if(r.enableVertexAttribArray(d),r.vertexAttribPointer(d,h.size,h.type||r.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(d,1)}}}},We.prototype.draw=function(e,t,r,i){var n,o,s=this.gl,a=this._activeGeometry;return a.indexBuffer?(o=2===(n=a.indexBuffer.data.BYTES_PER_ELEMENT)?s.UNSIGNED_SHORT:s.UNSIGNED_INT,(2===n||4===n&&this.canUseUInt32ElementIndex)&&(a.instanced?s.drawElementsInstanced(e,t||a.indexBuffer.data.length,o,(r||0)*n,i||1):s.drawElements(e,t||a.indexBuffer.data.length,o,(r||0)*n))):a.instanced?s.drawArraysInstanced(e,r,t||a.getSize(),i||1):s.drawArrays(e,r,t||a.getSize()),this},We.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},We.prototype.destroy=function(){this.renderer=null},We),Xe=(Object.defineProperty(ze.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null},enumerable:!1,configurable:!0}),ze.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=m.j.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},ze.prototype.copyCountersOrReset=function(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},ze);function ze(e){void 0===e&&(e=null),this.type=m.j.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=p.b.FILTER_MULTISAMPLE,this.enabled=!0,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._target=null}function We(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}function Ye(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Q(10,10),this.msaaSamples=null}function Ke(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}function qe(e){this.renderer=e,this.emptyRenderer=new Pe(e),this.currentRenderer=this.emptyRenderer}function Ze(e){this.renderer=e}function $e(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new fe,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new Ae,this.quadUv=new Ie,this.tempRect=new u.j,this.activeState={},this.globalUniforms=new Fe({outputFrame:new u.j,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}function Je(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=m.l.NONE,this.sourceFrame=new u.j,this.destinationFrame=new u.j,this.bindingSourceFrame=new u.j,this.bindingDestinationFrame=new u.j,this.filters=[],this.transform=null}function Qe(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Ce++,this.static=!!t,this.ubo=!!r,e instanceof me?(this.buffer=e,this.buffer.type=m.d.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new me(new Float32Array(1)),this.buffer.type=m.d.UNIFORM_BUFFER,this.autoManage=!0))}function et(){var e=xe.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new me(e.vertices),e.uvBuffer=new me(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}function tt(){var e=Ee.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}function rt(e,t){void 0===t&&(t={}),this.buffers=e=void 0===e?[]:e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=Re++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new i.a("disposeGeometry"),this.refCount=0}function it(e,t,r){t=e.createShader(t);return e.shaderSource(t,r),e.compileShader(t),t}function nt(e,t){var r=e.getShaderSource(t).split("\n").map(function(e,t){return t+": "+e}),t=e.getShaderInfoLog(t),t=t.split("\n"),i={},t=t.map(function(e){return parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(e){return!(!e||i[e]||(i[e]=!0,0))}),n=[""];t.forEach(function(e){r[e-1]="%c"+r[e-1]+"%c",n.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});t=r.join("\n");n[0]=t}function ot(e){for(var t=new Array(e),r=0;r<t.length;r++)t[r]=!1;return t}function st(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return ot(2*t);case"bvec3":return ot(3*t);case"bvec4":return ot(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var at,ut={},ht=ut;function lt(){var e,t;return at||(at=m.m.MEDIUM,(ht===ut||ht&&ht.isContextLost())&&(e=document.createElement("canvas"),t=void 0,(t=p.b.PREFER_ENV>=m.g.WEBGL2?e.getContext("webgl2",{}):t)||((t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}))?t.getExtension("WEBGL_draw_buffers"):t=null),ht=t),(t=ht)&&t.getShaderPrecisionFormat&&(t=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),at=t.precision?m.m.HIGH:m.m.MEDIUM)),at}function dt(e,t,r){if("precision"===e.substring(0,9))return r!==m.m.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e;var i=t;return"precision "+(i=t===m.m.HIGH&&r!==m.m.HIGH?m.m.MEDIUM:i)+" float;\n"+e}var ft={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function ct(e){return ft[e]}var pt=null,mt={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function vt(e,t){if(!pt){var r=Object.keys(mt);pt={};for(var i=0;i<r.length;++i){var n=r[i];pt[e[n]]=mt[n]}}return pt[t]}var gt=[{test:function(e){return"float"===e.type&&1===e.size},code:function(e){return'\n            if(uv["'+e+'"] !== ud["'+e+'"].value)\n            {\n                ud["'+e+'"].value = uv["'+e+'"]\n                gl.uniform1f(ud["'+e+'"].location, uv["'+e+'"])\n            }\n            '}},{test:function(e){return("sampler2D"===e.type||"samplerCube"===e.type||"sampler2DArray"===e.type)&&1===e.size&&!e.isArray},code:function(e){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+e+'"], t);\n\n            if(ud["'+e+'"].value !== t)\n            {\n                ud["'+e+'"].value = t;\n                gl.uniform1i(ud["'+e+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(e,t){return"mat3"===e.type&&1===e.size&&void 0!==t.a},code:function(e){return'\n            gl.uniformMatrix3fv(ud["'+e+'"].location, false, uv["'+e+'"].toArray(true));\n            '},codeUbo:function(e){return"\n                var "+e+"_matrix = uv."+e+".toArray(true);\n\n                data[offset] = "+e+"_matrix[0];\n                data[offset+1] = "+e+"_matrix[1];\n                data[offset+2] = "+e+"_matrix[2];\n        \n                data[offset + 4] = "+e+"_matrix[3];\n                data[offset + 5] = "+e+"_matrix[4];\n                data[offset + 6] = "+e+"_matrix[5];\n        \n                data[offset + 8] = "+e+"_matrix[6];\n                data[offset + 9] = "+e+"_matrix[7];\n                data[offset + 10] = "+e+"_matrix[8];\n            "}},{test:function(e,t){return"vec2"===e.type&&1===e.size&&void 0!==t.x},code:function(e){return'\n                cv = ud["'+e+'"].value;\n                v = uv["'+e+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+e+'"].location, v.x, v.y);\n                }'},codeUbo:function(e){return"\n                v = uv."+e+";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            "}},{test:function(e){return"vec2"===e.type&&1===e.size},code:function(e){return'\n                cv = ud["'+e+'"].value;\n                v = uv["'+e+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+e+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(e,t){return"vec4"===e.type&&1===e.size&&void 0!==t.width},code:function(e){return'\n                cv = ud["'+e+'"].value;\n                v = uv["'+e+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+e+'"].location, v.x, v.y, v.width, v.height)\n                }'},codeUbo:function(e){return"\n                    v = uv."+e+";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                "}},{test:function(e){return"vec4"===e.type&&1===e.size},code:function(e){return'\n                cv = ud["'+e+'"].value;\n                v = uv["'+e+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+e+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],yt={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},_t={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var bt,xt=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Et(e,t){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var r=t.createShader(t.FRAGMENT_SHADER);;){var i=xt.replace(/%forloop%/gi,function(e){for(var t="",r=0;r<e;++r)0<r&&(t+="\nelse "),r<e-1&&(t+="if(test == "+r+".0){}");return t}(e));if(t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS))break;e=e/2|0}return e}var Tt,Rt,St,wt,At=0,It={},Ct=(Object.defineProperty(tr,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(tr,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),tr.from=function(e,t,r){var i=e+t,n=v.d[i];return n||(v.d[i]=n=new tr(e,t,r)),n},tr),Ft=(er.prototype.checkUniformExists=function(e,t){if(t.uniforms[e])return!0;for(var r in t.uniforms){r=t.uniforms[r];if(r.group&&this.checkUniformExists(e,r))return!0}return!1},er.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(er.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),er.from=function(e,t,r){return new er(Ct.from(e,t),r)},er),Ot=(Object.defineProperty(Qt.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(e){!!(1&this.data)!==e&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(Qt.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(e){!!(2&this.data)!==e&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(Qt.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(e){!!(4&this.data)!==e&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(Qt.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(e){!!(8&this.data)!==e&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(Qt.prototype,"depthMask",{get:function(){return!!(32&this.data)},set:function(e){!!(32&this.data)!==e&&(this.data^=32)},enumerable:!1,configurable:!0}),Object.defineProperty(Qt.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(e){!!(16&this.data)!==e&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(Qt.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==m.b.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(Qt.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(e){this.offsets=!!e,this._polygonOffset=e},enumerable:!1,configurable:!0}),Qt.prototype.toString=function(){return"[@pixi/core:State blendMode="+this.blendMode+" clockwiseFrontFace="+this.clockwiseFrontFace+" culling="+this.culling+" depthMask="+this.depthMask+" polygonOffset="+this.polygonOffset+"]"},Qt.for2d=function(){var e=new Qt;return e.depthTest=!1,e.blend=!0,e},Qt),Nt=(a(Jt,wt=Ft),Jt.prototype.apply=function(e,t,r,i,n){e.applyFilter(this,t,r,i)},Object.defineProperty(Jt.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(Jt.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!1,configurable:!0}),Object.defineProperty(Jt,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(Jt,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),Jt),Mt=new u.d,Bt=(Object.defineProperty($t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._textureID=-1},enumerable:!1,configurable:!0}),$t.prototype.multiplyUvs=function(e,t){void 0===t&&(t=e);for(var r=this.mapCoord,i=0;i<e.length;i+=2){var n=e[i],o=e[i+1];t[i]=n*r.a+o*r.c+r.tx,t[i+1]=n*r.b+o*r.d+r.ty}return t},$t.prototype.update=function(e){var t=this._texture;if(!t||!t.valid)return!1;if(!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;var r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var i=t.orig,n=t.trim;n&&(Mt.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Mt));e=t.baseTexture,r=this.uClampFrame,i=this.clampMargin/e.resolution,n=this.clampOffset;return r[0]=(t._frame.x+i+n)/e.width,r[1]=(t._frame.y+i+n)/e.height,r[2]=(t._frame.x+t._frame.width-i+n)/e.width,r[3]=(t._frame.y+t._frame.height-i+n)/e.height,this.uClampOffset[0]=n/e.realWidth,this.uClampOffset[1]=n/e.realHeight,this.isSimple=t._frame.width===e.width&&t._frame.height===e.height&&0===t.rotate,!0},$t),Pt=(a(Zt,St=Nt),Object.defineProperty(Zt.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),Zt.prototype.apply=function(e,t,r,i){var n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Bt(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,t,r,i))},Zt),Ut=(qt.prototype.setMaskStack=function(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)},qt.prototype.push=function(e,t){var r=t;r.isMaskData||((i=this.maskDataPool.pop()||new Xe).pooled=!0,i.maskObject=t,r=i);var i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(i),r.autoDetect&&this.detect(r),r._target=e,r.type!==m.j.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case m.j.SCISSOR:this.renderer.scissor.push(r);break;case m.j.STENCIL:this.renderer.stencil.push(r);break;case m.j.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r)}r.type===m.j.SPRITE&&this.maskStack.push(r)},qt.prototype.pop=function(e){var t,r=this.maskStack.pop();if(r&&r._target===e){if(r.enabled)switch(r.type){case m.j.SCISSOR:this.renderer.scissor.pop();break;case m.j.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case m.j.SPRITE:this.popSpriteMask(r)}r.reset(),r.pooled&&this.maskDataPool.push(r),0!==this.maskStack.length&&(t=this.maskStack[this.maskStack.length-1]).type===m.j.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}},qt.prototype.detect=function(e){e.maskObject.isSprite?e.type=m.j.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=m.j.SCISSOR:e.type=m.j.STENCIL},qt.prototype.pushSpriteMask=function(e){var t=e.maskObject,r=e._target,i=e._filters;i||(i=(i=this.alphaMaskPool[this.alphaMaskIndex])||(this.alphaMaskPool[this.alphaMaskIndex]=[new Pt]));var n,o,s=this.renderer,a=s.renderTexture;u=a.current?(n=a.current,o=e.resolution||n.resolution,null!==(a=e.multisample)&&void 0!==a?a:n.multisample):(o=e.resolution||s.resolution,null!==(u=e.multisample)&&void 0!==u?u:s.multisample),i[0].resolution=o,i[0].multisample=u,i[0].maskSprite=t;var u=r.filterArea;r.filterArea=t.getBounds(!0),s.filter.push(r,i),r.filterArea=u,e._filters||this.alphaMaskIndex++},qt.prototype.popSpriteMask=function(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},qt.prototype.destroy=function(){this.renderer=null},qt),r=(Kt.prototype.getStackLength=function(){return this.maskStack.length},Kt.prototype.setMaskStack=function(e){var t=this.renderer.gl,r=this.getStackLength();this.maskStack=e;e=this.getStackLength();e!==r&&(0===e?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))},Kt.prototype._useCurrent=function(){},Kt.prototype.destroy=function(){this.renderer=null,this.maskStack=null},Kt),Dt=new u.d,Lt=(a(Yt,Rt=r),Yt.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0},Yt.prototype.calcScissorRect=function(e){var t,r,i,n,o;e._scissorRectLocal||(t=e._scissorRect,r=e.maskObject,n=(i=this.renderer).renderTexture,r.renderable=!0,o=r.getBounds(),this.roundFrameToPixels(o,(n.current||i).resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),r.renderable=!1,t&&o.fit(t),e._scissorRectLocal=o)},Yt.isMatrixRotated=function(e){if(!e)return!1;var t=e.a,r=e.b,i=e.c,e=e.d;return(1e-4<Math.abs(r)||1e-4<Math.abs(i))&&(1e-4<Math.abs(t)||1e-4<Math.abs(e))},Yt.prototype.testScissor=function(e){var t=e.maskObject;if(!t.isFastRect||!t.isFastRect())return!1;if(Yt.isMatrixRotated(t.worldTransform))return!1;if(Yt.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);e=e._scissorRectLocal;return 0<e.width&&0<e.height},Yt.prototype.roundFrameToPixels=function(e,t,r,i,n){Yt.isMatrixRotated(n)||((n=n?Dt.copyFrom(n):Dt.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,e),e.fit(i),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))},Yt.prototype.push=function(e){e._scissorRectLocal||this.calcScissorRect(e);var t=this.renderer.gl;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()},Yt.prototype.pop=function(){var e=this.renderer.gl;0<this.getStackLength()?this._useCurrent():e.disable(e.SCISSOR_TEST)},Yt.prototype._useCurrent=function(){var e=this.maskStack[this.maskStack.length-1]._scissorRect,t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y;this.renderer.gl.scissor(e.x,t,e.width,e.height)},Yt),Gt=(a(Wt,Tt=r),Wt.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0},Wt.prototype.push=function(e){var t=e.maskObject,r=this.renderer.gl,i=e._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,i,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent()},Wt.prototype.pop=function(e){var t=this.renderer.gl;0===this.getStackLength()?t.disable(t.STENCIL_TEST):(t.colorMask(!1,!1,!1,!1),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent())},Wt.prototype._useCurrent=function(){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},Wt),kt=(zt.prototype.update=function(e,t,r,i){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)},zt.prototype.calculateProjection=function(e,t,r,i){var n=this.projectionMatrix,i=i?-1:1;n.identity(),n.a=1/t.width*2,n.d=i*(1/t.height*2),n.tx=-1-t.x*n.a,n.ty=-i-t.y*n.d},zt.prototype.setTransform=function(e){},zt.prototype.destroy=function(){this.renderer=null},zt),jt=new u.j,Vt=new u.j,Ht=(Xt.prototype.bind=function(e,t,r){var i,n,o,s=this.renderer;(this.current=e=void 0===e?null:e)?(o=(i=e.baseTexture).resolution,t||(jt.width=e.frame.width,jt.height=e.frame.height,t=jt),r||(Vt.x=e.frame.x,Vt.y=e.frame.y,Vt.width=t.width,Vt.height=t.height,r=Vt),n=i.framebuffer):(o=s.resolution,t||(jt.width=s.screen.width,jt.height=s.screen.height,t=jt),r||((r=jt).width=t.width,r.height=t.height));var a=this.viewportFrame;a.x=r.x*o,a.y=r.y*o,a.width=r.width*o,a.height=r.height*o,e||(a.y=s.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(n,a),this.renderer.projection.update(r,t,o,!n),e?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)},Xt.prototype.clear=function(e,t){e=this.current?e||this.current.baseTexture.clearColor:e||this.clearColor;var r,i,n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer.screen,s=n.width!==o.width||n.height!==o.height;s&&(r=(i=this.viewportFrame).x,n=i.y,o=i.width,i=i.height,r=Math.round(r),n=Math.round(n),o=Math.round(o),i=Math.round(i),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(r,n,o,i)),this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],t),s&&this.renderer.scissor.pop()},Xt.prototype.resize=function(){this.bind(null)},Xt.prototype.reset=function(){this.bind(null)},Xt.prototype.destroy=function(){this.renderer=null},Xt);function Xt(e){this.renderer=e,this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new u.j,this.destinationFrame=new u.j,this.viewportFrame=new u.j}function zt(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new u.d,this.transform=null}function Wt(e){e=Tt.call(this,e)||this;return e.glConst=WebGLRenderingContext.STENCIL_TEST,e}function Yt(e){e=Rt.call(this,e)||this;return e.glConst=WebGLRenderingContext.SCISSOR_TEST,e}function Kt(e){this.renderer=e,this.maskStack=[],this.glConst=0}function qt(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}function Zt(e,t,r){var i=this,n=null;return"string"!=typeof e&&void 0===t&&void 0===r&&(n=e,r=t=e=void 0),(i=St.call(this,e||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",t||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",r)||this).maskSprite=n,i.maskMatrix=new u.d,i}function $t(e,t){this._texture=e,this.mapCoord=new u.d,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===t?.5:t,this.isSimple=!1}function Jt(e,t,r){var i=this,t=Ct.from(e||Jt.defaultVertexSrc,t||Jt.defaultFragmentSrc);return(i=wt.call(this,t,r)||this).padding=0,i.resolution=p.b.FILTER_RESOLUTION,i.multisample=p.b.FILTER_MULTISAMPLE,i.enabled=!0,i.autoFit=!0,i.state=new Ot,i}function Qt(){this.data=0,this.blendMode=m.b.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}function er(e,t){this.uniformBindCount=0,this.program=e,this.uniformGroup=t?t instanceof Fe?t:new Fe(t):new Fe({})}function tr(e,t,r){void 0===r&&(r="pixi-shader"),this.id=At++,this.vertexSrc=e||tr.defaultVertexSrc,this.fragmentSrc=t||tr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),It[r]?(It[r]++,r+="-"+It[r]):It[r]=1,this.vertexSrc="#define SHADER_NAME "+r+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+"\n"+this.fragmentSrc,this.vertexSrc=dt(this.vertexSrc,p.b.PRECISION_VERTEX,m.m.HIGH),this.fragmentSrc=dt(this.fragmentSrc,p.b.PRECISION_FRAGMENT,lt())),this.glPrograms={},this.syncUniforms=null}function rr(e,t,r,i,n){r.buffer.update(n)}var ir={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},nr={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function or(e,t){if(!e.autoManage)return{size:0,syncFunc:rr};for(var t=function(e){for(var t=e.map(function(e){return{data:e,offset:0,dataLen:0,dirty:0}}),r=0,i=0,n=0,o=0;o<t.length;o++){var s,a=t[o],r=nr[a.data.type];1<a.data.size&&(r=Math.max(r,16)*a.data.size),i%(a.dataLen=r)!=0&&i<16&&(i+=s=i%r%16,n+=s),16<i+r?(n=16*Math.ceil(n/16),a.offset=n,n+=r,i=r):(a.offset=n,i+=r,n+=r)}return{uboElements:t,size:n=16*Math.ceil(n/16)}}(function(e,t){var r,i=[];for(r in e)t[r]&&i.push(t[r]);return i.sort(function(e,t){return e.index-t.index}),i}(e.uniforms,t)),r=t.uboElements,t=t.size,i=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "],n=0;n<r.length;n++){for(var o,s,a=r[n],u=e.uniforms[a.data.name],h=a.data.name,l=!1,d=0;d<gt.length;d++){var f=gt[d];if(f.codeUbo&&f.test(a.data,u)){i.push("offset = "+a.offset/4+";",gt[d].codeUbo(a.data.name,u)),l=!0;break}}l||(1<a.data.size?(o=ct(a.data.type),s=Math.max(nr[a.data.type]/16,1),i.push("\n                cv = ud."+h+".value;\n                v = uv."+h+";\n                offset = "+a.offset/4+";\n\n                t = 0;\n\n                for(var i=0; i < "+a.data.size*s+"; i++)\n                {\n                    for(var j = 0; j < "+(s=o/s)+"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += "+(4-s%4)%4+";\n                }\n\n                ")):(s=ir[a.data.type],i.push("\n                cv = ud."+h+".value;\n                v = uv."+h+";\n                offset = "+a.offset/4+";\n                "+s+";\n                ")))}return i.push("\n       renderer.buffer.update(buffer);\n    "),{size:t,syncFunc:new Function("ud","uv","renderer","syncData","buffer",i.join("\n"))}}var sr=(ar.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},ar);function ar(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}function ur(e,t){var r,i,n,o,s=it(e,e.VERTEX_SHADER,t.vertexSrc),a=it(e,e.FRAGMENT_SHADER,t.fragmentSrc),u=e.createProgram();if(e.attachShader(u,s),e.attachShader(u,a),e.linkProgram(u),e.getProgramParameter(u,e.LINK_STATUS)||(i=u,n=s,o=a,(r=e).getProgramParameter(i,r.LINK_STATUS)||(r.getShaderParameter(n,r.COMPILE_STATUS)||nt(r,n),r.getShaderParameter(o,r.COMPILE_STATUS)||nt(r,o),r.getProgramInfoLog(i))),t.attributeData=function(e,t){for(var r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var o,s=t.getActiveAttrib(e,n);0!==s.name.indexOf("gl_")&&(o={type:o=vt(t,s.type),name:s.name,size:ct(o),location:t.getAttribLocation(e,s.name)},r[s.name]=o)}return r}(u,e),t.uniformData=function(e,t){for(var r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=0;n<i;n++){var o=t.getActiveUniform(e,n),s=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),u=vt(t,o.type);r[s]={name:s,index:n,type:u,size:o.size,isArray:a,value:st(u,o.size)}}return r}(u,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){var h=Object.keys(t.attributeData);h.sort(function(e,t){return t<e?1:-1});for(var l=0;l<h.length;l++)t.attributeData[h[l]].location=l,e.bindAttribLocation(u,l,h[l]);e.linkProgram(u)}e.deleteShader(s),e.deleteShader(a);var d={};for(l in t.uniformData){var f=t.uniformData[l];d[l]={location:e.getUniformLocation(u,l),value:st(f.type,f.size)}}return new sr(u,d)}var hr=0,lr={textureCount:0,uboCount:0},dr=(fr.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof bt)return bt;try{var e=new Function("param1","param2","param3","return param1[param2] === param3;");bt=!0===e({a:"b"},"a","b")}catch(e){bt=!1}return bt}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},fr.prototype.contextChange=function(e){this.gl=e,this.reset()},fr.prototype.bind=function(e,t){e.uniforms.globals=this.renderer.globalUniforms;var r=e.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),t||(lr.textureCount=0,lr.uboCount=0,this.syncUniformGroup(e.uniformGroup,lr)),i},fr.prototype.setUniforms=function(e){var t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)},fr.prototype.syncUniformGroup=function(e,t){var r=this.getGlProgram();e.static&&e.dirtyId===r.uniformDirtyGroups[e.id]||(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))},fr.prototype.syncUniforms=function(e,t,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,r)},fr.prototype.createSyncGroups=function(e){var t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=function(e,t){var r,i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(r in e.uniforms){var n=t[r];if(n){for(var o,s=e.uniforms[r],a=!1,u=0;u<gt.length;u++)if(gt[u].test(n,s)){i.push(gt[u].code(r,s)),a=!0;break}a||(o=(1===n.size?yt:_t)[n.type].replace("location",'ud["'+r+'"].location'),i.push('\n            cu = ud["'+r+'"];\n            cv = cu.value;\n            v = uv["'+r+'"];\n            '+o+";"))}else null!==(o=e.uniforms[r])&&void 0!==o&&o.group&&(e.uniforms[r].ubo?i.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+r+", '"+r+"');\n                    "):i.push("\n                        renderer.shader.syncUniformGroup(uv."+r+", syncData);\n                    "))}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]},fr.prototype.syncUniformBufferGroup=function(e,t){var r,i=this.getGlProgram();e.static&&0===e.dirtyId&&i.uniformGroups[e.id]||(e.dirtyId=0,r=i.uniformGroups[e.id]||this.createSyncBufferGroup(e,i,t),e.buffer.update(),r(i.uniformData,e.uniforms,this.renderer,lr,e.buffer)),this.renderer.buffer.bindBufferBase(e.buffer,i.uniformBufferBindings[t])},fr.prototype.createSyncBufferGroup=function(e,t,r){var i=this.renderer.gl;this.renderer.buffer.bind(e.buffer);var n=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(t.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;var i=this.getSignature(e,this.shader.program.uniformData,"ubo"),n=(n=this._uboCache[i])||(this._uboCache[i]=or(e,this.shader.program.uniformData));return e.autoManage&&(i=new Float32Array(n.size/4),e.buffer.update(i)),t.uniformGroups[e.id]=n.syncFunc,t.uniformGroups[e.id]},fr.prototype.getSignature=function(e,t,r){var i,n=[r+"-"];for(i in e.uniforms)n.push(i),t[i]&&n.push(t[i].type);return n.join("-")},fr.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},fr.prototype.generateProgram=function(e){var t=this.gl,e=e.program,t=ur(t,e);return e.glPrograms[this.renderer.CONTEXT_UID]=t},fr.prototype.reset=function(){this.program=null,this.shader=null},fr.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},fr);function fr(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=hr++}var cr=(vr.prototype.contextChange=function(e){var t;this.gl=e,this.blendModes=(e=e,(t=void 0===t?[]:t)[m.b.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.ADD]=[e.ONE,e.ONE],t[m.b.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.NONE]=[0,0],t[m.b.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[m.b.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[m.b.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[m.b.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[m.b.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[m.b.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[m.b.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[m.b.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[m.b.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[m.b.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[m.b.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t),this.set(this.defaultState),this.reset()},vr.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var t=this.stateId^e.data,r=0;t;)1&t&&this.map[r].call(this,!!(e.data&1<<r)),t>>=1,r++;this.stateId=e.data}for(r=0;r<this.checks.length;r++)this.checks[r](this,e)},vr.prototype.forceState=function(e){e=e||this.defaultState;for(var t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data},vr.prototype.setBlend=function(e){this.updateCheck(vr.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},vr.prototype.setOffset=function(e){this.updateCheck(vr.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},vr.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},vr.prototype.setDepthMask=function(e){this.gl.depthMask(e)},vr.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},vr.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},vr.prototype.setBlendMode=function(e){var t;e!==this.blendMode&&(this.blendMode=e,t=this.blendModes[e],e=this.gl,2===t.length?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD)))},vr.prototype.setPolygonOffset=function(e,t){this.gl.polygonOffset(e,t)},vr.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},vr.prototype.updateCheck=function(e,t){var r=this.checks.indexOf(e);t&&-1===r?this.checks.push(e):t||-1===r||this.checks.splice(r,1)},vr.checkBlendMode=function(e,t){e.setBlendMode(t.blendMode)},vr.checkPolygonOffset=function(e,t){e.setPolygonOffset(1,t.polygonOffset)},vr.prototype.destroy=function(){this.gl=null},vr),pr=(mr.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==m.i.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},mr.prototype.run=function(){for(var e=this.renderer.texture,t=e.managedTextures,r=!1,i=0;i<t.length;i++){var n=t[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),r=!(t[i]=null))}if(r){for(var o=0,i=0;i<t.length;i++)null!==t[i]&&(t[o++]=t[i]);t.length=o}},mr.prototype.unload=function(e){var t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(var i=e.children.length-1;0<=i;i--)this.unload(e.children[i])},mr.prototype.destroy=function(){this.renderer=null},mr);function mr(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=p.b.GC_MAX_IDLE,this.checkCountMax=p.b.GC_MAX_CHECK_COUNT,this.mode=p.b.GC_MODE}function vr(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=m.b.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new Ot,this.defaultState.blend=!0}var gr,yr,_r=function(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=m.r.UNSIGNED_BYTE,this.internalFormat=m.h.RGBA,this.samplerType=0},br=(Cr.prototype.contextChange=function(){var e,t,r,i=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=(e=i,s="WebGL2RenderingContext"in self&&e instanceof self.WebGL2RenderingContext?((r={})[m.r.UNSIGNED_BYTE]=((t={})[m.h.RGBA]=e.RGBA8,t[m.h.RGB]=e.RGB8,t[m.h.RG]=e.RG8,t[m.h.RED]=e.R8,t[m.h.RGBA_INTEGER]=e.RGBA8UI,t[m.h.RGB_INTEGER]=e.RGB8UI,t[m.h.RG_INTEGER]=e.RG8UI,t[m.h.RED_INTEGER]=e.R8UI,t[m.h.ALPHA]=e.ALPHA,t[m.h.LUMINANCE]=e.LUMINANCE,t[m.h.LUMINANCE_ALPHA]=e.LUMINANCE_ALPHA,t),r[m.r.BYTE]=((t={})[m.h.RGBA]=e.RGBA8_SNORM,t[m.h.RGB]=e.RGB8_SNORM,t[m.h.RG]=e.RG8_SNORM,t[m.h.RED]=e.R8_SNORM,t[m.h.RGBA_INTEGER]=e.RGBA8I,t[m.h.RGB_INTEGER]=e.RGB8I,t[m.h.RG_INTEGER]=e.RG8I,t[m.h.RED_INTEGER]=e.R8I,t),r[m.r.UNSIGNED_SHORT]=((t={})[m.h.RGBA_INTEGER]=e.RGBA16UI,t[m.h.RGB_INTEGER]=e.RGB16UI,t[m.h.RG_INTEGER]=e.RG16UI,t[m.h.RED_INTEGER]=e.R16UI,t[m.h.DEPTH_COMPONENT]=e.DEPTH_COMPONENT16,t),r[m.r.SHORT]=((t={})[m.h.RGBA_INTEGER]=e.RGBA16I,t[m.h.RGB_INTEGER]=e.RGB16I,t[m.h.RG_INTEGER]=e.RG16I,t[m.h.RED_INTEGER]=e.R16I,t),r[m.r.UNSIGNED_INT]=((t={})[m.h.RGBA_INTEGER]=e.RGBA32UI,t[m.h.RGB_INTEGER]=e.RGB32UI,t[m.h.RG_INTEGER]=e.RG32UI,t[m.h.RED_INTEGER]=e.R32UI,t[m.h.DEPTH_COMPONENT]=e.DEPTH_COMPONENT24,t),r[m.r.INT]=((t={})[m.h.RGBA_INTEGER]=e.RGBA32I,t[m.h.RGB_INTEGER]=e.RGB32I,t[m.h.RG_INTEGER]=e.RG32I,t[m.h.RED_INTEGER]=e.R32I,t),r[m.r.FLOAT]=((t={})[m.h.RGBA]=e.RGBA32F,t[m.h.RGB]=e.RGB32F,t[m.h.RG]=e.RG32F,t[m.h.RED]=e.R32F,t[m.h.DEPTH_COMPONENT]=e.DEPTH_COMPONENT32F,t),r[m.r.HALF_FLOAT]=((t={})[m.h.RGBA]=e.RGBA16F,t[m.h.RGB]=e.RGB16F,t[m.h.RG]=e.RG16F,t[m.h.RED]=e.R16F,t),r[m.r.UNSIGNED_SHORT_5_6_5]=((t={})[m.h.RGB]=e.RGB565,t),r[m.r.UNSIGNED_SHORT_4_4_4_4]=((t={})[m.h.RGBA]=e.RGBA4,t),r[m.r.UNSIGNED_SHORT_5_5_5_1]=((t={})[m.h.RGBA]=e.RGB5_A1,t),r[m.r.UNSIGNED_INT_2_10_10_10_REV]=((t={})[m.h.RGBA]=e.RGB10_A2,t[m.h.RGBA_INTEGER]=e.RGB10_A2UI,t),r[m.r.UNSIGNED_INT_10F_11F_11F_REV]=((t={})[m.h.RGB]=e.R11F_G11F_B10F,t),r[m.r.UNSIGNED_INT_5_9_9_9_REV]=((t={})[m.h.RGB]=e.RGB9_E5,t),r[m.r.UNSIGNED_INT_24_8]=((t={})[m.h.DEPTH_STENCIL]=e.DEPTH24_STENCIL8,t),r[m.r.FLOAT_32_UNSIGNED_INT_24_8_REV]=((t={})[m.h.DEPTH_STENCIL]=e.DEPTH32F_STENCIL8,t),r):((s={})[m.r.UNSIGNED_BYTE]=((r={})[m.h.RGBA]=e.RGBA,r[m.h.RGB]=e.RGB,r[m.h.ALPHA]=e.ALPHA,r[m.h.LUMINANCE]=e.LUMINANCE,r[m.h.LUMINANCE_ALPHA]=e.LUMINANCE_ALPHA,r),s[m.r.UNSIGNED_SHORT_5_6_5]=((r={})[m.h.RGB]=e.RGB,r),s[m.r.UNSIGNED_SHORT_4_4_4_4]=((r={})[m.h.RGBA]=e.RGBA,r),s[m.r.UNSIGNED_SHORT_5_5_5_1]=((r={})[m.h.RGBA]=e.RGBA,r),s));var n=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=n;for(var o=0;o<n;o++)this.boundTextures[o]=null;this.emptyTextures={};var s=new _r(i.createTexture());for(i.bindTexture(i.TEXTURE_2D,s.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[i.TEXTURE_2D]=s,this.emptyTextures[i.TEXTURE_CUBE_MAP]=new _r(i.createTexture()),i.bindTexture(i.TEXTURE_CUBE_MAP,this.emptyTextures[i.TEXTURE_CUBE_MAP].texture),o=0;o<6;o++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,null);for(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),o=0;o<this.boundTextures.length;o++)this.bind(null,o)},Cr.prototype.bind=function(e,t){void 0===t&&(t=0);var r,i=this.gl;(e=null==e?void 0:e.castToBaseTexture())&&e.valid&&!e.parentTextureArray?(e.touched=this.renderer.textureGC.count,r=e._glTextures[this.CONTEXT_UID]||this.initTexture(e),this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(e.target,r.texture)),r.dirtyId!==e.dirtyId&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),this.updateTexture(e)),this.boundTextures[t]=e):(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[t]=null)},Cr.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},Cr.prototype.unbind=function(e){var t=this.gl,r=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var i=0;i<r.length;i++)r[i]===this.unknownTexture&&this.bind(null,i)}for(i=0;i<r.length;i++)r[i]===e&&(this.currentLocation!==i&&(t.activeTexture(t.TEXTURE0+i),this.currentLocation=i),t.bindTexture(e.target,this.emptyTextures[e.target].texture),r[i]=null)},Cr.prototype.ensureSamplerType=function(e){var t=this.boundTextures,r=this.hasIntegerTextures,i=this.CONTEXT_UID;if(r)for(var n=e-1;0<=n;--n){var o=t[n];o&&o._glTextures[i].samplerType!==m.o.FLOAT&&this.renderer.texture.unbind(o)}},Cr.prototype.initTexture=function(e){var t=new _r(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t},Cr.prototype.initTextureType=function(e,t){var r;t.internalFormat=null!==(r=null===(r=this.internalFormats[e.type])||void 0===r?void 0:r[e.format])&&void 0!==r?r:e.format,2===this.webGLVersion&&e.type===m.r.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type},Cr.prototype.updateTexture=function(e){var t,r,i,n=e._glTextures[this.CONTEXT_UID];n&&(i=this.renderer,this.initTextureType(e,n),e.resource&&e.resource.upload(i,e,n)?n.samplerType!==m.o.FLOAT&&(this.hasIntegerTextures=!0):(t=e.realWidth,r=e.realHeight,i=i.gl,(n.width!==t||n.height!==r||n.dirtyId<0)&&(n.width=t,n.height=r,i.texImage2D(e.target,0,n.internalFormat,t,r,0,e.format,n.type,null))),e.dirtyStyleId!==n.dirtyStyleId&&this.updateTextureStyle(e),n.dirtyId=e.dirtyId)},Cr.prototype.destroyTexture=function(e,t){var r,i=this.gl;(e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)&&-1!==(r=this.managedTextures.indexOf(e))&&Object(v.x)(this.managedTextures,r,1)},Cr.prototype.updateTextureStyle=function(e){var t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==m.k.POW2&&2===this.webGLVersion||e.isPowerOfTwo?t.mipmap=1<=e.mipmap:t.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?t.wrapMode=e.wrapMode:t.wrapMode=m.s.CLAMP,e.resource&&e.resource.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)},Cr.prototype.setStyle=function(e,t){var r,i=this.gl;t.mipmap&&e.mipmap!==m.k.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,t.wrapMode),t.mipmap?(i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===m.p.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),(r=this.renderer.context.extensions.anisotropicFiltering)&&0<e.anisotropicLevel&&e.scaleMode===m.p.LINEAR&&(t=Math.min(e.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),i.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY_EXT,t))):i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===m.p.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===m.p.LINEAR?i.LINEAR:i.NEAREST)},Cr.prototype.destroy=function(){this.renderer=null},Cr),xr={__proto__:null,FilterSystem:Be,BatchSystem:Ue,ContextSystem:Le,FramebufferSystem:je,GeometrySystem:He,MaskSystem:Ut,ScissorSystem:Lt,StencilSystem:Gt,ProjectionSystem:kt,RenderTextureSystem:Ht,ShaderSystem:dr,StateSystem:cr,TextureGCSystem:pr,TextureSystem:br},Er=new u.d,r=(a(Ir,yr=v.c),Ir.prototype.initPlugins=function(e){for(var t in e)this.plugins[t]=new e[t](this)},Object.defineProperty(Ir.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(Ir.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),Ir.prototype.resize=function(e,t){this.view.width=Math.round(e*this.resolution),this.view.height=Math.round(t*this.resolution);e=this.view.width/this.resolution,t=this.view.height/this.resolution;this.screen.width=e,this.screen.height=t,this.autoDensity&&(this.view.style.width=e+"px",this.view.style.height=t+"px"),this.emit("resize",e,t)},Ir.prototype.generateTexture=function(e,t,r,i){"number"==typeof(t=void 0===t?{}:t)&&(Object(v.h)("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),t={scaleMode:t,resolution:r,region:i});r=t.region,t=function(e,t){var r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]]);return r}(t,["region"]);0===(i=r||e.getLocalBounds(null,!0)).width&&(i.width=1),0===i.height&&(i.height=1);t=de.create(h({width:i.width,height:i.height},t));return Er.tx=-i.x,Er.ty=-i.y,this.render(e,{renderTexture:t,clear:!1,transform:Er,skipUpdateTransform:!!e.parent}),t},Ir.prototype.destroy=function(e){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);e=this;e.plugins=null,e.type=m.n.UNKNOWN,e.view=null,e.screen=null,e._tempDisplayObjectParent=null,e.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(Ir.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=Object(v.n)(e),Object(v.m)(e,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(Ir.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(e){this._backgroundColorRgba[3]=e},enumerable:!1,configurable:!0}),Ir),Tr=function(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},Rr=(Ar.prototype.destroy=function(){this.renderer=null},Ar.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},Ar.prototype.bind=function(e){var t=this.gl,r=this.CONTEXT_UID,r=e._glBuffers[r]||this.createGLBuffer(e);t.bindBuffer(e.type,r.buffer)},Ar.prototype.bindBufferBase=function(e,t){var r=this.gl,i=this.CONTEXT_UID;this.boundBufferBases[t]!==e&&(i=e._glBuffers[i]||this.createGLBuffer(e),this.boundBufferBases[t]=e,r.bindBufferBase(r.UNIFORM_BUFFER,t,i.buffer))},Ar.prototype.bindBufferRange=function(e,t,r){var i=this.gl,n=this.CONTEXT_UID;r=r||0;e=e._glBuffers[n]||this.createGLBuffer(e);i.bindBufferRange(i.UNIFORM_BUFFER,t||0,e.buffer,256*r,256)},Ar.prototype.update=function(e){var t=this.gl,r=this.CONTEXT_UID,i=e._glBuffers[r];e._updateID!==i.updateID&&(i.updateID=e._updateID,t.bindBuffer(e.type,i.buffer),i.byteLength>=e.data.byteLength?t.bufferSubData(e.type,0,e.data):(r=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW,i.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,r)))},Ar.prototype.dispose=function(e,t){var r,i;this.managedBuffers[e.id]&&(delete this.managedBuffers[e.id],r=e._glBuffers[this.CONTEXT_UID],i=this.gl,e.disposeRunner.remove(this),r&&(t||i.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID]))},Ar.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedBuffers),r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)},Ar.prototype.createGLBuffer=function(e){var t=this.CONTEXT_UID,r=this.gl;return e._glBuffers[t]=new Tr(r.createBuffer()),(this.managedBuffers[e.id]=e).disposeRunner.add(this),e._glBuffers[t]},Ar),Sr=(a(wr,gr=r),wr.create=function(e){if(Object(v.q)())return new wr(e);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},wr.prototype.contextChange=function(){var e,t,r=this.gl;1===this.context.webGLVersion?(t=r.getParameter(r.FRAMEBUFFER_BINDING),r.bindFramebuffer(r.FRAMEBUFFER,null),e=r.getParameter(r.SAMPLES),r.bindFramebuffer(r.FRAMEBUFFER,t)):(t=r.getParameter(r.DRAW_FRAMEBUFFER_BINDING),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),e=r.getParameter(r.SAMPLES),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,t)),e>=m.l.HIGH?this.multisample=m.l.HIGH:e>=m.l.MEDIUM?this.multisample=m.l.MEDIUM:e>=m.l.LOW?this.multisample=m.l.LOW:this.multisample=m.l.NONE},wr.prototype.addSystem=function(e,t){var r,i=new e(this);if(this[t])throw new Error('Whoops! The name "'+t+'" is already in use');for(r in this[t]=i,this.runners)this.runners[r].add(i);return this},wr.prototype.render=function(e,t){var r,i,n,o;t&&(o=t instanceof de?(Object(v.h)("6.0.0","Renderer#render arguments changed, use options instead."),r=t,i=arguments[2],n=arguments[3],arguments[4]):(r=t.renderTexture,i=t.clear,n=t.transform,t.skipUpdateTransform)),this.renderingToScreen=!r,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=n,this.context.isLost||(r||(this._lastObjectRendered=e),o||(o=e.enableTempParent(),e.updateTransform(),e.disableTempParent(o)),this.renderTexture.bind(r),this.batch.currentRenderer.start(),(void 0!==i?i:this.clearBeforeRender)&&this.renderTexture.clear(),e.render(this),this.batch.currentRenderer.flush(),r&&r.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender"))},wr.prototype.generateTexture=function(e,t,r,i){i=gr.prototype.generateTexture.call(this,e,t=void 0===t?{}:t,r,i);return this.framebuffer.blit(),i},wr.prototype.resize=function(e,t){gr.prototype.resize.call(this,e,t),this.runners.resize.emit(this.screen.height,this.screen.width)},wr.prototype.reset=function(){return this.runners.reset.emit(),this},wr.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},wr.prototype.destroy=function(e){for(var t in this.runners.destroy.emit(),this.runners)this.runners[t].destroy();gr.prototype.destroy.call(this,e),this.gl=null},Object.defineProperty(wr.prototype,"extract",{get:function(){return Object(v.h)("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),wr.registerPlugin=function(e,t){(wr.__plugins=wr.__plugins||{})[e]=t},wr);function wr(e){var t=gr.call(this,m.n.WEBGL,e)||this;return e=t.options,t.gl=null,t.CONTEXT_UID=0,t.runners={destroy:new i.a("destroy"),contextChange:new i.a("contextChange"),reset:new i.a("reset"),update:new i.a("update"),postrender:new i.a("postrender"),prerender:new i.a("prerender"),resize:new i.a("resize")},t.runners.contextChange.add(t),t.globalUniforms=new Fe({projectionMatrix:new u.d},!0),t.addSystem(Ut,"mask").addSystem(Le,"context").addSystem(cr,"state").addSystem(dr,"shader").addSystem(br,"texture").addSystem(Rr,"buffer").addSystem(He,"geometry").addSystem(je,"framebuffer").addSystem(Lt,"scissor").addSystem(Gt,"stencil").addSystem(kt,"projection").addSystem(pr,"textureGC").addSystem(Be,"filter").addSystem(Ht,"renderTexture").addSystem(Ue,"batch"),t.initPlugins(wr.__plugins),t.multisample=void 0,e.context?t.context.initFromContext(e.context):t.context.initFromOptions({alpha:!!t.useContextAlpha,antialias:e.antialias,premultipliedAlpha:t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:t.options.powerPreference}),t.renderingToScreen=!0,Object(v.z)(2===t.context.webGLVersion?"WebGL 2":"WebGL 1"),t.resize(t.options.width,t.options.height),t}function Ar(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}function Ir(e,t){void 0===e&&(e=m.n.UNKNOWN);var r=yr.call(this)||this;return t=Object.assign({},p.b.RENDER_OPTIONS,t),r.options=t,r.type=e,r.screen=new u.j(0,0,t.width,t.height),r.view=t.view||document.createElement("canvas"),r.resolution=t.resolution||p.b.RESOLUTION,r.useContextAlpha=t.useContextAlpha,r.autoDensity=!!t.autoDensity,r.preserveDrawingBuffer=t.preserveDrawingBuffer,r.clearBeforeRender=t.clearBeforeRender,r._backgroundColor=0,r._backgroundColorRgba=[0,0,0,1],r._backgroundColorString="#000000",r.backgroundColor=t.backgroundColor||r._backgroundColor,r.backgroundAlpha=t.backgroundAlpha,void 0!==t.transparent&&(Object(v.h)("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),r.useContextAlpha=t.transparent,r.backgroundAlpha=t.transparent?0:1),r._lastObjectRendered=null,r.plugins={},r}function Cr(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new I,this.hasIntegerTextures=!1}function Fr(e){return Sr.create(e)}var Or,Nr,Mr="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Br="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Pr=function(){this.texArray=null,this.blend=0,this.type=m.f.TRIANGLES,this.start=0,this.size=0,this.data=null},Ur=(Zr.prototype.clear=function(){for(var e=0;e<this.count;e++)this.elements[e]=null;this.count=0},Zr),Dr=(Object.defineProperty(qr.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(qr.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(qr.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(qr.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(qr.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),qr.prototype.view=function(e){return this[e+"View"]},qr.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},qr.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},qr),Lr=(a(Kr,Nr=Pe),Kr.prototype.contextChange=function(){var e=this.renderer.gl;p.b.PREFER_ENV===m.g.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),p.b.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Et(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()},Kr.prototype.initFlushBuffers=function(){for(var e=Kr._drawCallPool,t=Kr._textureArrayPool,r=this.size/4,i=Math.floor(r/this.MAX_TEXTURES)+1;e.length<r;)e.push(new Pr);for(;t.length<i;)t.push(new Ur);for(var n=0;n<this.MAX_TEXTURES;n++)this._tempBoundTextures[n]=null},Kr.prototype.onPrerender=function(){this._flushId=0},Kr.prototype.render=function(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)},Kr.prototype.buildTexturesAndDrawCalls=function(){var e=this._bufferedTextures,t=this.MAX_TEXTURES,r=Kr._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count,s=++I._globalBatch,a=0,u=r[0],h=0;i.copyBoundTextures(n,t);for(var l=0;l<this._bufferSize;++l){var d=e[l];e[l]=null,d._batchEnabled!==s&&(u.count>=t&&(i.boundArray(u,n,s,t),this.buildDrawCalls(u,h,l),h=l,u=r[++a],++s),d._batchEnabled=s,d.touched=o,u.elements[u.count++]=d)}for(0<u.count&&(i.boundArray(u,n,s,t),this.buildDrawCalls(u,h,this._bufferSize),++a,++s),l=0;l<n.length;l++)n[l]=null;I._globalBatch=s},Kr.prototype.buildDrawCalls=function(e,t,r){var i=this._bufferedElements,n=this._attributeBuffer,o=this._indexBuffer,s=this.vertexSize,a=Kr._drawCallPool,u=this._dcIndex,h=this._aIndex,l=this._iIndex,d=a[u];d.start=this._iIndex,d.texArray=e;for(var f=t;f<r;++f){var c=i[f],p=c._texture.baseTexture,p=v.t[p.alphaMode?1:0][c.blendMode];i[f]=null,t<f&&d.blend!==p&&(d.size=l-d.start,t=f,(d=a[++u]).texArray=e,d.start=l),this.packInterleavedGeometry(c,n,o,h,l),h+=c.vertexData.length/2*s,l+=c.indices.length,d.blend=p}t<r&&(d.size=l-d.start,++u),this._dcIndex=u,this._aIndex=h,this._iIndex=l},Kr.prototype.bindAndClearTexArray=function(e){for(var t=this.renderer.texture,r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0},Kr.prototype.updateGeometry=function(){var e=this._packedGeometries,t=this._attributeBuffer,r=this._indexBuffer;p.b.CAN_UPLOAD_SAME_BUFFER?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},Kr.prototype.drawBatches=function(){for(var e=this._dcIndex,t=this.renderer,r=t.gl,i=t.state,n=Kr._drawCallPool,o=null,s=0;s<e;s++){var a=n[s],u=a.texArray,h=a.type,l=a.size,d=a.start,a=a.blend;o!==u&&this.bindAndClearTexArray(o=u),this.state.blendMode=a,i.set(this.state),r.drawElements(h,l,r.UNSIGNED_SHORT,2*d)}},Kr.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},Kr.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),p.b.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},Kr.prototype.stop=function(){this.flush()},Kr.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),Nr.prototype.destroy.call(this)},Kr.prototype.getAttributeBuffer=function(e){var t=Object(v.s)(Math.ceil(e/8)),e=Object(v.r)(t),t=8*t;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);e=this._aBuffers[t];return e||(this._aBuffers[t]=e=new Dr(t*this.vertexSize*4)),e},Kr.prototype.getIndexBuffer=function(e){var t=Object(v.s)(Math.ceil(e/12)),r=Object(v.r)(t),e=12*t;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);t=this._iBuffers[r];return t||(this._iBuffers[r]=t=new Uint16Array(e)),t},Kr.prototype.packInterleavedGeometry=function(e,t,r,i,n){for(var o=t.uint32View,s=t.float32View,a=i/this.vertexSize,u=e.uvs,h=e.indices,l=e.vertexData,d=e._texture.baseTexture._batchLocation,t=Math.min(e.worldAlpha,1),f=t<1&&e._texture.baseTexture.alphaMode?Object(v.v)(e._tintRGB,t):e._tintRGB+(255*t<<24),c=0;c<l.length;c+=2)s[i++]=l[c],s[i++]=l[c+1],s[i++]=u[c],s[i++]=u[c+1],o[i++]=f,s[i++]=d;for(c=0;c<h.length;c++)r[n++]=a+h[c]},Kr._drawCallPool=[],Kr._textureArrayPool=[],Kr),Gr=(Yr.prototype.generateShader=function(e){if(!this.programCache[e]){for(var t=new Int32Array(e),r=0;r<e;r++)t[r]=r;this.defaultGroupCache[e]=Fe.from({uSamplers:t},!0);var i=this.fragTemplate;i=(i=i.replace(/%count%/gi,""+e)).replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Ct(this.vertexSrc,i)}i={tint:new Float32Array([1,1,1,1]),translationMatrix:new u.d,default:this.defaultGroupCache[e]};return new Ft(this.programCache[e],i)},Yr.prototype.generateSampleSrc=function(e){var t="";t+="\n",t+="\n";for(var r=0;r<e;r++)0<r&&(t+="\nelse "),r<e-1&&(t+="if(vTextureId < "+r+".5)"),t+="\n{",t+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",t+="\n}";return t+="\n",t+="\n"},Yr),kr=(a(Wr,Or=we),Wr),jr="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Vr="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",Hr=(zr.create=function(e){var t,e=Object.assign({vertex:jr,fragment:Vr,geometryClass:kr,vertexSize:6},e),r=e.vertex,i=e.fragment,n=e.vertexSize,o=e.geometryClass;return a(s,t=Lr),s;function s(e){e=t.call(this,e)||this;return e.shaderGenerator=new Gr(r,i),e.geometryClass=o,e.vertexSize=n,e}},Object.defineProperty(zr,"defaultVertexSrc",{get:function(){return jr},enumerable:!1,configurable:!0}),Object.defineProperty(zr,"defaultFragmentTemplate",{get:function(){return Vr},enumerable:!1,configurable:!0}),zr).create(),Xr={};function zr(){}function Wr(e){void 0===e&&(e=!1);var t=Or.call(this)||this;return t._buffer=new me(null,e,!1),t._indexBuffer=new me(null,e,!0),t.addAttribute("aVertexPosition",t._buffer,2,!1,m.r.FLOAT).addAttribute("aTextureCoord",t._buffer,2,!1,m.r.FLOAT).addAttribute("aColor",t._buffer,4,!0,m.r.UNSIGNED_BYTE).addAttribute("aTextureId",t._buffer,1,!0,m.r.FLOAT).addIndex(t._indexBuffer),t}function Yr(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},t.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(t.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}function Kr(e){var t=Nr.call(this,e)||this;return t.shaderGenerator=null,t.geometryClass=null,t.vertexSize=null,t.state=Ot.for2d(),t.size=4*p.b.SPRITE_BATCH_SIZE,t._vertexCount=0,t._indexCount=0,t._bufferedElements=[],t._bufferedTextures=[],t._bufferSize=0,t._shader=null,t._packedGeometries=[],t._packedGeometryPoolSize=2,t._flushId=0,t._aBuffers={},t._iBuffers={},t.MAX_TEXTURES=1,t.renderer.on("prerender",t.onPrerender,t),e.runners.contextChange.add(t),t._dcIndex=0,t._aIndex=0,t._iIndex=0,t._attributeBuffer=null,t._indexBuffer=null,t._tempBoundTextures=[],t}function qr(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}function Zr(){this.elements=[],this.ids=[],this.count=0}for($r in $)!function(e){Object.defineProperty(Xr,e,{get:function(){return Object(v.h)("6.0.0","PIXI.systems."+e+" has moved to PIXI."+e),$[e]}})}($r);var $r,Jr={};for($r in xr)!function(e){Object.defineProperty(Jr,e,{get:function(){return Object(v.h)("6.0.0","PIXI.resources."+e+" has moved to PIXI."+e),xr[e]}})}($r)}}]);